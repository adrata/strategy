generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// RBAC models for granular permission control
model roles {
  id               String             @id @default(ulid())
  name             String             @unique @db.VarChar(50)
  description      String?            @db.VarChar(255)
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  role_permissions role_permissions[]
  user_roles       user_roles[]

  @@index([isActive])
}

model permissions {
  id               String             @id @default(ulid())
  name             Permission         @unique
  description      String?            @db.VarChar(255)
  resource         String             @db.VarChar(50)
  action           String             @db.VarChar(50)
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  role_permissions role_permissions[]

  @@index([resource, action])
  @@index([isActive])
}

model role_permissions {
  id           String      @id @default(ulid())
  roleId       String
  permissionId String
  createdAt    DateTime    @default(now())
  permission   permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         roles       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
}

model user_roles {
  id          String      @id @default(ulid())
  userId      String      @db.VarChar(30)
  roleId      String
  workspaceId String?     @db.VarChar(30)
  isActive    Boolean     @default(true)
  assignedAt  DateTime    @default(now())
  assignedBy  String?     @db.VarChar(30)
  expiresAt   DateTime?
  role        roles       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user        users       @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace   workspaces? @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId, workspaceId])
  @@index([userId])
  @@index([roleId])
  @@index([workspaceId])
  @@index([isActive])
  @@index([expiresAt])
}

/// Multi-tenant workspace management
model workspaces {
  id                        String                      @id @default(ulid())
  name                      String
  slug                      String                      @unique
  timezone                  String                      @default("UTC") @db.VarChar(50)
  description               String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  isActive                  Boolean                     @default(true)
  deletedAt                 DateTime?
  businessModel             String?                     @db.VarChar(100)
  competitiveAdvantages     String[]                    @default([])
  idealCustomerProfile      String?                     @db.VarChar(2000)
  industry                  String?                     @db.VarChar(100)
  productPortfolio          String[]                    @default([])
  salesMethodology          String?                     @db.VarChar(200)
  serviceOfferings          String[]                    @default([])
  targetCompanySize         String[]                    @default([])
  targetIndustries          String[]                    @default([])
  valuePropositions         String[]                    @default([])
  speedrunDailyTarget       Int?                        @default(50)
  speedrunWeeklyTarget      Int?                        @default(250)
  newsEnabled               Boolean?                    @default(false)
  newsIndustries            String[]                    @default([])
  newsSources               String[]                    @default([])
  enabledFeatures           String[]                    @default([])
  oasis_channels            OasisChannel[]
  oasis_direct_messages     OasisDirectMessage[]
  OasisExternalConnection   OasisExternalConnection[]
  stacks_projects           StacksProject[]
  actions                   actions[]
  ai_conversations          ai_conversations[]
  api_cost_tracking         api_cost_tracking[]
  audit_logs                audit_logs[]
  auth_sessions             auth_sessions[]
  companies                 companies[]
  emails                    email_messages[]
  grand_central_connections grand_central_connections[]
  grand_central_workflows   grand_central_workflows[]
  people                    people[]
  research_data             research_data[]
  user_roles                user_roles[]
  users                     users[]
  workspace_users           workspace_users[]
  
  // Workshop relations
  workshopDocuments           workshopDocument[]
  workshopFolders            workshopFolder[]
  api_keys                   api_keys[]

  @@index([slug])
  @@index([isActive])
  @@index([deletedAt])
}

/// User accounts and authentication
model users {
  id                                                                    String                      @id @default(ulid())
  email                                                                 String                      @unique
  password                                                              String?
  name                                                                  String
  firstName                                                             String?
  lastName                                                              String?
  timezone                                                              String?                     @db.VarChar(50)
  createdAt                                                             DateTime                    @default(now())
  updatedAt                                                             DateTime
  lastLoginAt                                                           DateTime?
  isActive                                                              Boolean                     @default(true)
  activeWorkspaceId                                                     String?                     @db.VarChar(30)
  username                                                              String?                     @unique @db.VarChar(50)
  speedrunRankingMode                                                   String?                     @db.VarChar(50)
  oasis_channel_members                                                 OasisChannelMember[]
  oasis_dm_participants                                                 OasisDMParticipant[]
  OasisExternalConnection_OasisExternalConnection_externalUserIdTousers OasisExternalConnection[]   @relation("OasisExternalConnection_externalUserIdTousers")
  OasisExternalConnection_OasisExternalConnection_userIdTousers         OasisExternalConnection[]   @relation("OasisExternalConnection_userIdTousers")
  oasis_messages                                                        OasisMessage[]
  oasis_reactions                                                       OasisReaction[]
  oasis_read_receipts                                                   OasisReadReceipt[]
  stacks_story_assignees                                                StacksStory[]
  stacks_task_assignees                                                 StacksTask[]
  assigned_actions                                                      actions[]                   @relation("AssignedActions")
  ai_conversations                                                      ai_conversations[]
  api_cost_tracking                                                     api_cost_tracking[]
  audit_logs                                                            audit_logs[]
  auth_sessions                                                         auth_sessions[]
  main_seller_companies                                                 companies[]                 @relation("MainSellerCompanies")
  grand_central_connections                                             grand_central_connections[]
  grand_central_workflows                                               grand_central_workflows[]
  main_seller_people                                                    people[]                    @relation("MainSellerPeople")
  person_co_sellers                                                     person_co_sellers[]
  reset_tokens                                                          reset_tokens[]
  user_roles                                                            user_roles[]
  workspaces                                                            workspaces?                 @relation(fields: [activeWorkspaceId], references: [id])
  workspace_users                                                       workspace_users[]
  api_keys                                                              api_keys[]
  
  // Workshop relations
  workshopDocumentsOwned                                                 workshopDocument[]            @relation("WorkshopDocumentOwner")
  workshopDocumentsCreated                                               workshopDocument[]            @relation("WorkshopDocumentCreatedBy")
  workshopFoldersOwned                                                   workshopFolder[]
  workshopSharesCreated                                                  workshopShare[]
  workshopVersionsCreated                                                workshopVersion[]
  workshopCommentsCreated                                                workshopComment[]
  workshopActivitiesPerformed                                            workshopActivity[]

  @@index([activeWorkspaceId])
  @@index([username])
}

/// Workspace membership and basic roles
model workspace_users {
  id          String     @id @default(ulid())
  workspaceId String     @db.VarChar(30)
  userId      String     @db.VarChar(30)
  role        UserRole   @default(VIEWER)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  isActive    Boolean    @default(true)
  joinedAt    DateTime   @default(now())
  user        users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace   workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([userId])
  @@index([workspaceId, role])
  @@index([isActive])
}

/// JWT session management
model auth_sessions {
  id             String     @id @default(ulid())
  userId         String     @db.VarChar(30)
  workspaceId    String     @db.VarChar(30)
  token          String     @unique @db.VarChar(500)
  refreshToken   String     @unique @db.VarChar(500)
  expiresAt      DateTime
  createdAt      DateTime   @default(now())
  lastAccessedAt DateTime   @default(now())
  isActive       Boolean    @default(true)
  user           users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace      workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([isActive])
  @@index([refreshToken])
  @@index([token])
  @@index([userId])
  @@index([workspaceId])
}

/// Password reset functionality
model reset_tokens {
  id        String   @id @default(ulid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  metadata  Json?
  user      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([token])
  @@index([used])
  @@index([userId])
}

/// API Keys for external API access
model api_keys {
  id                      String           @id @default(ulid())
  workspaceId             String            @db.VarChar(30)
  userId                  String            @db.VarChar(30)
  name                    String            @db.VarChar(255)
  keyPrefix               String            @db.VarChar(50) // e.g., "adrata_live_"
  hashedKey               String            @db.VarChar(255) // bcrypt hash of the secret portion
  lastUsedAt              DateTime?
  expiresAt               DateTime?
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
  isActive                Boolean           @default(true)
  
  // Enhanced security fields
  scopes                  String[]         @default([]) // e.g., ["buyer-groups:read", "companies:read"]
  allowedIps              String[]        @default([]) // IP addresses/CIDR blocks allowed
  deniedIps                String[]         @default([]) // IP addresses/CIDR blocks blocked
  rateLimitPerHour         Int?             @default(1000) // Requests per hour
  rateLimitPerDay          Int?             @default(10000) // Requests per day
  
  // Key rotation fields
  lastRotatedAt            DateTime?
  rotationGracePeriodEndsAt DateTime?      // Grace period after rotation
  
  workspace                workspaces        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  user                     users            @relation(fields: [userId], references: [id], onDelete: Cascade)
  usage                    api_key_usage[]

  @@index([workspaceId])
  @@index([userId])
  @@index([keyPrefix])
  @@index([isActive])
  @@index([expiresAt])
  @@index([lastUsedAt])
}

/// API Key Usage Tracking
model api_key_usage {
  id          String    @id @default(ulid())
  apiKeyId    String    @db.VarChar(30)
  endpoint    String    @db.VarChar(255)
  method      String    @db.VarChar(10)
  statusCode  Int
  responseTime Int      // milliseconds
  ipAddress   String?   @db.VarChar(45) // IPv4 or IPv6
  userAgent   String?   @db.VarChar(500)
  createdAt   DateTime  @default(now())
  apiKey      api_keys  @relation(fields: [apiKeyId], references: [id], onDelete: Cascade)

  @@index([apiKeyId])
  @@index([createdAt])
  @@index([endpoint])
  @@index([statusCode])
}

/// Core Companies - Global canonical company data (no workspaceId)
model core_companies {
  id                     String           @id @default(ulid()) @db.VarChar(30)
  name                   String           @unique @db.VarChar(255)
  normalizedName         String           @unique @db.VarChar(255)
  legalName              String?          @db.VarChar(255)
  tradingName            String?          @db.VarChar(255)
  website                String?          @db.VarChar(500)
  domain                 String?          @db.VarChar(255)
  industry               String?          @db.VarChar(100)
  sector                 String?          @db.VarChar(100)
  size                   String?          @db.VarChar(100)
  employeeCount          Int?
  foundedYear            Int?
  description            String?
  city                   String?          @db.VarChar(100)
  state                  String?          @db.VarChar(100)
  country                String?          @db.VarChar(100)
  hqCity                 String?          @db.VarChar(100)
  hqState                String?          @db.VarChar(100)
  hqCountryIso2          String?          @db.VarChar(2)
  hqCountryIso3          String?          @db.VarChar(3)
  linkedinUrl            String?          @db.VarChar(500)
  linkedinFollowers      Int?
  revenue                Decimal?         @db.Decimal(15, 2)
  currency               String?          @default("USD") @db.VarChar(3)
  stockSymbol            String?          @db.VarChar(20)
  logoUrl                String?          @db.VarChar(500)
  lastVerified           DateTime?
  dataLastVerified       DateTime?
  dataQualityScore       Float?           @default(0)
  dataSources            String[]         @default([])
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  companies              companies[]

  @@index([normalizedName])
  @@index([domain])
  @@index([lastVerified])
  @@index([dataLastVerified])
}

/// Company/organization data
model companies {
  id                     String           @id @default(ulid()) @db.VarChar(30)
  workspaceId            String           @db.VarChar(30)
  coreCompanyId          String?          @db.VarChar(30)
  name                   String           @db.VarChar(255)
  nameOverride           String?          @db.VarChar(255)
  industryOverride       String?          @db.VarChar(100)
  websiteOverride        String?          @db.VarChar(500)
  legalName              String?          @db.VarChar(255)
  tradingName            String?          @db.VarChar(255)
  localName              String?          @db.VarChar(255)
  description            String?
  website                String?          @db.VarChar(500)
  email                  String?          @db.VarChar(300)
  phone                  String?          @db.VarChar(50)
  fax                    String?          @db.VarChar(50)
  address                String?
  city                   String?          @db.VarChar(100)
  state                  String?          @db.VarChar(100)
  country                String?          @db.VarChar(100)
  postalCode             String?          @db.VarChar(20)
  industry               String?          @db.VarChar(100)
  sector                 String?          @db.VarChar(100)
  size                   String?          @db.VarChar(100)
  revenue                Decimal?         @db.Decimal(15, 2)
  currency               String?          @default("USD") @db.VarChar(3)
  employeeCount          Int?
  foundedYear            Int?
  registrationNumber     String?          @db.VarChar(100)
  taxId                  String?          @db.VarChar(100)
  vatNumber              String?          @db.VarChar(100)
  domain                 String?          @db.VarChar(255)
  logoUrl                String?          @db.VarChar(500)
  status                 CompanyStatus?   @default(ACTIVE)
  priority               CompanyPriority? @default(MEDIUM)
  tags                   String[]         @default([])
  customFields           Json?
  notes                  String?
  lastAction             String?
  lastActionDate         DateTime?        @db.Timestamp(6)
  nextAction             String?
  nextActionDate         DateTime?        @db.Timestamp(6)
  actionStatus           String?
  globalRank             Int?             @default(0)
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  entityId               String?          @db.VarChar(30)
  deletedAt              DateTime?
  mainSellerId           String?          @db.VarChar(30)
  actualCloseDate        DateTime?
  expectedCloseDate      DateTime?
  opportunityAmount      Decimal?         @db.Decimal(15, 2)
  opportunityProbability Float?
  opportunityStage       String?          @db.VarChar(50)
  acquisitionDate        DateTime?
  activeJobPostings      Int?             @default(0)
  businessChallenges     String[]         @default([])
  businessPriorities     String[]         @default([])
  companyIntelligence    Json?
  companyUpdates         Json?
  competitiveAdvantages  String[]         @default([])
  competitors            String[]         @default([])
  confidence             Float?           @default(0)
  decisionTimeline       String?          @db.VarChar(100)
  digitalMaturity        Int?             @default(0)
  facebookUrl            String?          @db.VarChar(500)
  githubUrl              String?          @db.VarChar(500)
  growthOpportunities    String[]         @default([])
  hqCity                 String?          @db.VarChar(100)
  hqCountryIso2          String?          @db.VarChar(2)
  hqCountryIso3          String?          @db.VarChar(3)
  hqFullAddress          String?          @db.VarChar(500)
  hqLocation             String?          @db.VarChar(200)
  hqRegion               String[]         @default([])
  hqState                String?          @db.VarChar(100)
  hqStreet               String?          @db.VarChar(200)
  hqZipcode              String?          @db.VarChar(20)
  instagramUrl           String?          @db.VarChar(500)
  isPublic               Boolean?         @default(false)
  keyInfluencers         String?          @db.VarChar(200)
  lastFundingAmount      BigInt?
  lastFundingDate        DateTime?
  lastVerified           DateTime?
  linkedinFollowers      Int?
  linkedinUrl            String?          @db.VarChar(500)
  marketPosition         String?          @db.VarChar(100)
  marketThreats          String[]         @default([])
  naicsCodes             String[]         @default([])
  numTechnologiesUsed    Int?             @default(0)
  parentCompanyDomain    String?          @db.VarChar(200)
  parentCompanyName      String?          @db.VarChar(200)
  sicCodes               String[]         @default([])
  sources                String[]         @default([])
  stockSymbol            String?          @db.VarChar(20)
  strategicInitiatives   String[]         @default([])
  successMetrics         String[]         @default([])
  techStack              String[]         @default([])
  technologiesUsed       String[]         @default([])
  twitterFollowers       Int?
  twitterUrl             String?          @db.VarChar(500)
  youtubeUrl             String?          @db.VarChar(500)
  nextActionReasoning    String?
  nextActionPriority     String?          @db.VarChar(20)
  nextActionType         String?          @db.VarChar(50)
  nextActionUpdatedAt    DateTime?
  acquisitionHistory     Json?
  aiConfidence           Float?           @default(0)
  aiIntelligence         Json?
  aiLastUpdated          DateTime?
  dataLastVerified       DateTime?
  dataQualityBreakdown   Json?
  dataQualityScore       Float?           @default(0)
  dataSources            String[]         @default([])
  employeeCountChange    Json?
  employeeReviewsScore   Json?
  executiveArrivals      Json?
  executiveDepartures    Json?
  fundingRounds          Json?
  jobPostingsChange      Json?
  productReviewsScore    Json?
  revenueRange           Json?
  linkedinnavigatorurl   String?          @db.VarChar(500)
  linkedinNavigatorUrl   String?          @db.VarChar(500)
  descriptionEnriched    String?
  actions                actions[]
  mainSeller             users?           @relation("MainSellerCompanies", fields: [mainSellerId], references: [id])
  workspace              workspaces       @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  coreCompany            core_companies?  @relation(fields: [coreCompanyId], references: [id], onDelete: SetNull)
  emails                 email_messages[]
  people                 people[]
  workshopDocuments        workshopDocument[]

  @@index([workspaceId])
  @@index([coreCompanyId])
  @@index([mainSellerId])
  @@index([entityId])
  @@index([deletedAt])
  @@index([workspaceId, status])
  @@index([workspaceId, mainSellerId, status])
  @@index([workspaceId, createdAt])
  @@index([customFields], type: Gin)
  @@index([workspaceId, globalRank])
  @@index([workspaceId, status, globalRank])
  @@index([confidence])
  @@index([lastVerified])
  @@index([acquisitionDate])
  @@index([marketPosition])
  @@index([digitalMaturity])
  @@index([companyIntelligence], type: Gin)
  @@index([aiIntelligence], type: Gin)
  @@index([employeeCountChange], type: Gin)
  @@index([workspaceId, dataQualityScore])
  @@index([dataSources], type: Gin)
}

/// Core People - Global canonical person data (no workspaceId)
model core_people {
  id                     String              @id @default(ulid()) @db.VarChar(30)
  firstName              String              @db.VarChar(100)
  lastName               String              @db.VarChar(100)
  fullName               String              @db.VarChar(200)
  normalizedFullName     String              @unique @db.VarChar(200)
  email                  String?             @unique @db.VarChar(300)
  workEmail              String?             @unique @db.VarChar(300)
  personalEmail          String?             @unique @db.VarChar(300)
  linkedinUrl            String?             @unique @db.VarChar(500)
  jobTitle               String?             @db.VarChar(300)
  department             String?             @db.VarChar(200)
  companyName            String?             @db.VarChar(200)
  currentCompany         String?             @db.VarChar(200)
  currentRole            String?             @db.VarChar(200)
  phone                  String?             @db.VarChar(50)
  mobilePhone            String?             @db.VarChar(50)
  workPhone              String?             @db.VarChar(50)
  linkedinConnections    Int?
  linkedinFollowers      Int?
  profilePictureUrl      String?             @db.VarChar(500)
  bio                    String?
  city                   String?             @db.VarChar(100)
  state                  String?             @db.VarChar(100)
  country                String?             @db.VarChar(100)
  lastVerified           DateTime?
  dataLastVerified       DateTime?
  dataQualityScore       Float?              @default(0)
  dataSources            String[]             @default([])
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  people                 people[]

  @@index([normalizedFullName])
  @@index([email])
  @@index([workEmail])
  @@index([personalEmail])
  @@index([linkedinUrl])
  @@index([lastVerified])
  @@index([dataLastVerified])
}

/// Contact/person records
model people {
  id                     String              @id @default(ulid()) @db.VarChar(30)
  workspaceId            String              @db.VarChar(30)
  corePersonId           String?             @db.VarChar(30)
  companyId              String?             @db.VarChar(30)
  firstName              String              @db.VarChar(100)
  lastName               String              @db.VarChar(100)
  fullName               String              @db.VarChar(200)
  fullNameOverride       String?             @db.VarChar(200)
  emailOverride          String?             @db.VarChar(300)
  jobTitleOverride       String?             @db.VarChar(300)
  displayName            String?             @db.VarChar(200)
  salutation             String?             @db.VarChar(50)
  suffix                 String?             @db.VarChar(50)
  jobTitle               String?             @db.VarChar(300)
  title                  String?             @db.VarChar(300)
  department             String?             @db.VarChar(200)
  seniority              String?             @db.VarChar(50)
  email                  String?             @db.VarChar(300)
  workEmail              String?             @db.VarChar(300)
  personalEmail          String?             @db.VarChar(300)
  phone                  String?             @db.VarChar(50)
  mobilePhone            String?             @db.VarChar(50)
  workPhone              String?             @db.VarChar(50)
  linkedinUrl            String?             @db.VarChar(500)
  address                String?             @db.VarChar(500)
  city                   String?             @db.VarChar(100)
  state                  String?             @db.VarChar(100)
  country                String?             @db.VarChar(100)
  postalCode             String?             @db.VarChar(50)
  dateOfBirth            DateTime?           @db.Timestamp(6)
  gender                 String?             @db.VarChar(20)
  bio                    String?
  profilePictureUrl      String?             @db.VarChar(500)
  status                 PersonStatus?       @default(LEAD)
  priority               PersonPriority?     @default(MEDIUM)
  source                 String?
  tags                   String[]            @default([])
  customFields           Json?
  notes                  String?
  preferredLanguage      String?             @db.VarChar(10)
  timezone               String?             @db.VarChar(50)
  emailVerified          Boolean?            @default(false)
  phoneVerified          Boolean?            @default(false)
  lastAction             String?
  lastActionDate         DateTime?           @db.Timestamp(6)
  nextAction             String?
  nextActionDate         DateTime?           @db.Timestamp(6)
  actionStatus           String?
  engagementScore        Float?              @default(0)
  globalRank             Int?                @default(0)
  companyRank            Int?                @default(0)
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  entityId               String?             @db.VarChar(30)
  deletedAt              DateTime?
  mainSellerId           String?             @db.VarChar(30)
  vertical               String?             @db.VarChar(100)
  achievements           String[]            @default([])
  budgetResponsibility   String?             @db.VarChar(100)
  buyerGroupOptimized    Boolean?            @default(false)
  buyerGroupRole         String?             @db.VarChar(50)
  buyerGroupStatus       String?             @db.VarChar(50)
  careerTimeline         Json?
  certifications         String[]            @default([])
  communicationStyle     String?             @db.VarChar(50)
  coresignalData         Json?
  currentCompany         String?             @db.VarChar(200)
  currentRole            String?             @db.VarChar(200)
  dataCompleteness       Float?              @default(0)
  decisionMaking         String?             @db.VarChar(50)
  decisionPower          Int?                @default(0)
  degrees                Json?
  emailConfidence        Float?              @default(0)
  engagementLevel        String?             @db.VarChar(50)
  engagementStrategy     String?             @db.VarChar(100)
  enrichedData           Json?
  enrichmentScore        Float?              @default(0)
  enrichmentSources      String[]            @default([])
  enrichmentVersion      String?             @db.VarChar(20)
  fieldsOfStudy          String[]            @default([])
  graduationYears        Int[]               @default([])
  hiddenFromSections     String[]            @default([])
  industryExperience     String?             @db.VarChar(100)
  industrySkills         String[]            @default([])
  influenceLevel         String?             @db.VarChar(50)
  influenceScore         Float?              @default(0)
  institutions           String[]            @default([])
  isBuyerGroupMember     Boolean?            @default(false)
  languages              String[]            @default([])
  lastEnriched           DateTime?
  leadershipExperience   String?             @db.VarChar(100)
  mobileVerified         Boolean?            @default(false)
  phoneConfidence        Float?              @default(0)
  preferredContact       String?             @db.VarChar(50)
  previousRoles          Json?
  publications           String[]            @default([])
  responseTime           String?             @db.VarChar(50)
  roleHistory            Json?
  rolePromoted           Json?
  softSkills             String[]            @default([])
  speakingEngagements    String[]            @default([])
  statusReason           String?             @db.VarChar(200)
  statusUpdateDate       DateTime?
  teamSize               String?             @db.VarChar(50)
  technicalSkills        String[]            @default([])
  totalExperience        Int?
  yearsAtCompany         Int?
  yearsInRole            Int?
  nextActionPriority     String?             @db.VarChar(20)
  nextActionReasoning    String?
  nextActionType         String?             @db.VarChar(50)
  nextActionUpdatedAt    DateTime?
  linkedinConnectionDate DateTime?           @db.Timestamp(6)
  linkedinNavigatorUrl   String?             @db.VarChar(500)
  decisionPowerScore     Int?                @default(0)
  yearsExperience        Int?
  aiConfidence           Float?              @default(0)
  aiIntelligence         Json?
  aiLastUpdated          DateTime?
  dataLastVerified       DateTime?
  dataQualityBreakdown   Json?
  dataQualityScore       Float?              @default(0)
  dataSources            String[]            @default([])
  emailQualityGrade      String?             @db.VarChar(10)
  linkedinConnections    Int?
  linkedinFollowers      Int?
  phoneQualityScore      Float?              @default(0)
  salaryProjections      Json?
  totalExperienceMonths  Int?
  actions                actions[]
  emails                 email_messages[]
  company                companies?          @relation(fields: [companyId], references: [id])
  mainSeller             users?              @relation("MainSellerPeople", fields: [mainSellerId], references: [id])
  workspace              workspaces          @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  corePerson             core_people?        @relation(fields: [corePersonId], references: [id], onDelete: SetNull)
  coSellers              person_co_sellers[]

  @@index([workspaceId])
  @@index([corePersonId])
  @@index([companyId])
  @@index([entityId])
  @@index([deletedAt])
  @@index([workspaceId, status])
  @@index([workspaceId, companyId, status])
  @@index([workspaceId, createdAt])
  @@index([customFields], type: Gin)
  @@index([mainSellerId])
  @@index([workspaceId, mainSellerId, status])
  @@index([workspaceId, globalRank])
  @@index([workspaceId, status, globalRank])
  @@index([buyerGroupRole])
  @@index([decisionPower])
  @@index([influenceLevel])
  @@index([enrichmentScore])
  @@index([lastEnriched])
  @@index([coresignalData], type: Gin)
  @@index([enrichedData], type: Gin)
  @@index([aiIntelligence], type: Gin)
  @@index([workspaceId, emailQualityGrade])
  @@index([workspaceId, dataQualityScore])
  @@index([dataSources], type: Gin)
}

/// Multi-player sales: Co-seller relationships
model person_co_sellers {
  id        String   @id @default(ulid())
  personId  String   @db.VarChar(30)
  userId    String   @db.VarChar(30)
  createdAt DateTime @default(now())
  person    people   @relation(fields: [personId], references: [id], onDelete: Cascade)
  user      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([personId, userId])
  @@index([personId])
  @@index([userId])
  @@index([createdAt])
}

/// Activity and task tracking
model actions {
  id          String         @id @default(ulid())
  workspaceId String         @db.VarChar(30)
  userId      String         @db.VarChar(30)
  companyId   String?        @db.VarChar(30)
  personId    String?        @db.VarChar(30)
  type        String         @db.VarChar(30)
  subject     String
  description String?
  outcome     String?
  scheduledAt DateTime?
  completedAt DateTime?
  status      ActionStatus   @default(PLANNED)
  priority    ActionPriority @default(NORMAL)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  deletedAt   DateTime?
  company     companies?     @relation(fields: [companyId], references: [id])
  person      people?        @relation(fields: [personId], references: [id])
  user        users          @relation("AssignedActions", fields: [userId], references: [id], onDelete: Cascade)
  workspace   workspaces     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([userId])
  @@index([companyId])
  @@index([personId])
  @@index([type])
  @@index([status])
  @@index([deletedAt])
  @@index([workspaceId, status])
  @@index([workspaceId, userId, status])
  @@index([workspaceId, scheduledAt])
  @@index([workspaceId, createdAt])
}

/// System audit trail for compliance
model audit_logs {
  id          String     @id @default(ulid())
  workspaceId String     @db.VarChar(30)
  userId      String     @db.VarChar(30)
  entityType  String     @db.VarChar(50)
  entityId    String     @db.VarChar(30)
  action      String     @db.VarChar(20)
  oldValues   Json?
  newValues   Json?
  timestamp   DateTime   @default(now())
  success     Boolean    @default(true)
  user        users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace   workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([userId])
  @@index([entityType])
  @@index([entityId])
  @@index([action])
  @@index([timestamp])
  @@index([workspaceId, entityType, timestamp])
  @@index([workspaceId, action, timestamp])
  @@index([success])
}

/// Track API costs for intelligence operations
model api_cost_tracking {
  id           String     @id @default(ulid()) @db.VarChar(30)
  workspaceId  String     @db.VarChar(30)
  userId       String?    @db.VarChar(30)
  apiProvider  String     @db.VarChar(50)
  endpoint     String?    @db.VarChar(100)
  operation    String?    @db.VarChar(50)
  cost         Decimal    @db.Decimal(10, 4)
  tokensUsed   Int?
  entityType   String?    @db.VarChar(20)
  entityId     String?    @db.VarChar(30)
  requestData  Json?
  success      Boolean    @default(true)
  errorMessage String?
  createdAt    DateTime   @default(now())
  user         users?     @relation(fields: [userId], references: [id])
  workspace    workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([apiProvider])
  @@index([createdAt])
  @@index([workspaceId, apiProvider])
  @@index([entityType, entityId])
}

/// Store Perplexity AI and other research data
model research_data {
  id             String     @id @default(ulid()) @db.VarChar(30)
  workspaceId    String     @db.VarChar(30)
  entityType     String     @db.VarChar(20)
  entityId       String     @db.VarChar(30)
  researchType   String     @db.VarChar(50)
  content        String?
  sources        Json?
  extractedData  Json?
  confidence     Float?     @default(0)
  model          String?    @db.VarChar(100)
  tokensUsed     Int?
  processingTime Int?
  cost           Decimal?   @db.Decimal(10, 4)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  expiresAt      DateTime?
  workspace      workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([entityType, entityId])
  @@index([researchType])
  @@index([createdAt])
  @@index([expiresAt])
}

/// Grand Central Integration Hub Models
model grand_central_connections {
  id                String     @id @default(ulid())
  workspaceId       String     @db.VarChar(30)
  userId            String     @db.VarChar(30)
  provider          String     @db.VarChar(100)
  providerConfigKey String     @db.VarChar(100)
  nangoConnectionId String     @unique @db.VarChar(100)
  connectionName    String?    @db.VarChar(255)
  metadata          Json       @default("{}")
  status            String     @default("active") @db.VarChar(50)
  lastSyncAt        DateTime?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  user              users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace         workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status])
  @@index([userId])
  @@index([provider])
}

model grand_central_workflows {
  id             String     @id @default(ulid())
  workspaceId    String     @db.VarChar(30)
  userId         String     @db.VarChar(30)
  name           String     @db.VarChar(255)
  description    String?
  nodes          Json       @default("[]")
  connections    Json       @default("[]")
  status         String     @default("draft") @db.VarChar(50)
  lastExecutedAt DateTime?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  user           users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace      workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status])
  @@index([userId])
}

model grand_central_executions {
  id          String    @id @default(ulid())
  workflowId  String    @db.VarChar(30)
  workspaceId String    @db.VarChar(30)
  status      String    @db.VarChar(50)
  logs        Json      @default("[]")
  error       String?
  startedAt   DateTime  @default(now())
  completedAt DateTime?

  @@index([workflowId])
  @@index([workspaceId, status])
  @@index([startedAt])
}

/// Oasis - Team Communication (Slack-like)
model OasisChannel {
  id          String               @id @default(cuid())
  workspaceId String               @db.VarChar(30)
  name        String               @db.VarChar(100)
  description String?              @db.VarChar(500)
  isPrivate   Boolean              @default(false)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  workspace   workspaces           @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  members     OasisChannelMember[]
  messages    OasisMessage[]

  @@index([workspaceId])
  @@index([workspaceId, name])
}

model OasisChannelMember {
  id        String       @id @default(cuid())
  channelId String
  userId    String       @db.VarChar(30)
  joinedAt  DateTime     @default(now())
  channel   OasisChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user      users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@index([channelId])
  @@index([userId])
}

model OasisDirectMessage {
  id           String               @id @default(cuid())
  workspaceId  String               @db.VarChar(30)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  participants OasisDMParticipant[]
  workspace    workspaces           @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  messages     OasisMessage[]

  @@index([workspaceId])
}

model OasisDMParticipant {
  id       String             @id @default(cuid())
  dmId     String
  userId   String             @db.VarChar(30)
  joinedAt DateTime           @default(now())
  dm       OasisDirectMessage @relation(fields: [dmId], references: [id], onDelete: Cascade)
  user     users              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([dmId, userId])
  @@index([dmId])
  @@index([userId])
}

model OasisMessage {
  id                 String              @id @default(cuid())
  content            String
  channelId          String?
  dmId               String?
  senderId           String              @db.VarChar(30)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  parentMessageId    String?
  channel            OasisChannel?       @relation(fields: [channelId], references: [id], onDelete: Cascade)
  dm                 OasisDirectMessage? @relation(fields: [dmId], references: [id], onDelete: Cascade)
  OasisMessage       OasisMessage?       @relation("OasisMessageToOasisMessage", fields: [parentMessageId], references: [id], onDelete: Cascade)
  other_OasisMessage OasisMessage[]      @relation("OasisMessageToOasisMessage")
  sender             users               @relation(fields: [senderId], references: [id], onDelete: Cascade)
  reactions          OasisReaction[]
  readReceipts       OasisReadReceipt[]

  @@index([channelId])
  @@index([dmId])
  @@index([senderId])
  @@index([createdAt])
  @@index([parentMessageId])
}

model OasisReaction {
  id        String       @id @default(cuid())
  messageId String
  userId    String       @db.VarChar(30)
  emoji     String       @db.VarChar(10)
  createdAt DateTime     @default(now())
  message   OasisMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@index([messageId])
  @@index([userId])
}

model OasisReadReceipt {
  id        String       @id @default(cuid())
  userId    String       @db.VarChar(30)
  messageId String
  readAt    DateTime     @default(now())
  message   OasisMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, messageId])
  @@index([userId])
  @@index([messageId])
  @@index([readAt])
}

/// Stacks - Project Management (Jira-like)
model StacksProject {
  id          String        @id @default(cuid())
  workspaceId String        @db.VarChar(30)
  name        String        @db.VarChar(200)
  description String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  epochs      StacksEpoch[]
  workspace   workspaces    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  stories     StacksStory[]
  tasks       StacksTask[]

  @@index([workspaceId])
  @@index([workspaceId, name])
}

model StacksEpoch {
  id          String        @id @default(cuid())
  projectId   String
  title       String        @db.VarChar(200)
  description String?
  status      String        @default("todo") @db.VarChar(20)
  priority    String        @default("medium") @db.VarChar(20)
  product     String?       @db.VarChar(50)
  section     String?       @db.VarChar(50)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  project     StacksProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  stories     StacksStory[]

  @@index([projectId])
  @@index([projectId, status])
}

model StacksStory {
  id             String        @id @default(cuid())
  epochId        String?
  projectId      String
  title          String        @db.VarChar(200)
  description    String?
  status         String        @default("todo") @db.VarChar(20)
  priority       String        @default("medium") @db.VarChar(20)
  assigneeId     String?       @db.VarChar(30)
  viewType       String?       @db.VarChar(20)
  product        String?       @db.VarChar(50)
  section        String?       @db.VarChar(50)
  statusChangedAt DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  assignee       users?        @relation(fields: [assigneeId], references: [id])
  epoch          StacksEpoch?  @relation(fields: [epochId], references: [id])
  project        StacksProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks          StacksTask[]

  @@index([epochId])
  @@index([projectId])
  @@index([assigneeId])
  @@index([projectId, status])
}

model StacksTask {
  id          String        @id @default(cuid())
  storyId     String?
  projectId   String
  title       String        @db.VarChar(200)
  description String?
  status      String        @default("todo") @db.VarChar(20)
  priority    String        @default("medium") @db.VarChar(20)
  type        String        @default("task") @db.VarChar(20)
  assigneeId  String?       @db.VarChar(30)
  product     String?       @db.VarChar(50)
  section     String?       @db.VarChar(50)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  assignee    users?        @relation(fields: [assigneeId], references: [id])
  project     StacksProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  story       StacksStory?  @relation(fields: [storyId], references: [id])

  @@index([storyId])
  @@index([projectId])
  @@index([assigneeId])
  @@index([projectId, status])
  @@index([projectId, type])
}

model BuyerGroupMembers {
  id             String         @id
  buyerGroupId   String
  name           String
  title          String?
  role           BuyerGroupRole
  email          String?
  phone          String?
  linkedin       String?
  confidence     Decimal?       @default(0) @db.Decimal(5, 2)
  influenceScore Decimal?       @default(0) @db.Decimal(5, 2)
  // V2 Enhancement fields - all optional to preserve existing data
  coresignalId   String?
  department     String?
  seniorityLevel String?
  location       String?
  profilePicture String?
  summary        String?
  experience     Json?
  skills         String[]       @default([])
  priority       Int?           @default(5)
  customFields   Json?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  BuyerGroups    BuyerGroups    @relation(fields: [buyerGroupId], references: [id], onDelete: Cascade)

  @@index([buyerGroupId])
  @@index([role])
  @@index([coresignalId])
}

model BuyerGroups {
  id                String              @id
  companyName       String
  website           String?
  industry          String?
  companySize       String?
  workspaceId       String?
  cohesionScore     Decimal?            @default(0) @db.Decimal(5, 2)
  overallConfidence Decimal?            @default(0) @db.Decimal(5, 2)
  totalMembers      Int                 @default(0)
  processingTime    Int                 @default(0)
  metadata          Json?
  // V2 Enhancement fields - all optional to preserve existing data
  companyId         String?
  status            String?             @default("active")
  enrichmentLevel   String?             @default("enrich")
  composition       Json?
  qualityMetrics    Json?
  creditsUsed       Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  BuyerGroupMembers BuyerGroupMembers[]

  @@index([companyName])
  @@index([createdAt])
  @@index([workspaceId])
  @@index([companyId])
  @@index([status])
}

model ChronicleReport {
  id             String              @id
  title          String
  reportType     ChronicleReportType
  content        Json
  weekStart      DateTime
  weekEnd        DateTime
  workspaceId    String
  userId         String
  createdAt      DateTime            @default(now())
  updatedAt      DateTime
  lastReadAt     DateTime?
  lastReadBy     String?
  ChronicleShare ChronicleShare[]

  @@index([userId, createdAt])
  @@index([workspaceId, weekStart])
}

model ChronicleShare {
  id              String          @id
  reportId        String
  shareToken      String          @unique
  shareUrl        String?
  expiresAt       DateTime?
  allowedEmails   String[]
  viewCount       Int             @default(0)
  createdAt       DateTime        @default(now())
  ChronicleReport ChronicleReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([shareToken])
}

/// AI Chat Persistence Models
model ai_conversations {
  id             String        @id @default(ulid())
  workspaceId    String        @db.VarChar(30)
  userId         String        @db.VarChar(30)
  title          String        @db.VarChar(200)
  lastActivity   DateTime      @updatedAt
  isActive       Boolean       @default(true)
  welcomeMessage String?
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?
  user           users         @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace      workspaces    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  messages       ai_messages[]

  @@index([workspaceId, userId, deletedAt])
  @@index([lastActivity])
  @@index([workspaceId, userId, isActive])
}

model ai_messages {
  id             String           @id @default(ulid())
  conversationId String
  type           MessageType
  content        String
  metadata       Json?
  createdAt      DateTime         @default(now())
  conversation   ai_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([conversationId, type])
}

/// Email messages from integrated providers
model email_messages {
  id          String     @id @default(ulid())
  workspaceId String     @db.VarChar(30)
  provider    String     @db.VarChar(50)
  messageId   String
  threadId    String?
  subject     String
  body        String
  bodyHtml    String?
  from        String     @db.VarChar(300)
  to          String[]   @default([])
  cc          String[]   @default([])
  bcc         String[]   @default([])
  sentAt      DateTime
  receivedAt  DateTime
  isRead      Boolean    @default(false)
  isImportant Boolean    @default(false)
  attachments Json?
  labels      String[]   @default([])
  companyId   String?    @db.VarChar(30)
  personId    String?    @db.VarChar(30)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  company     companies? @relation(fields: [companyId], references: [id])
  person      people?    @relation(fields: [personId], references: [id])
  workspace   workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([provider, messageId, workspaceId])
  @@index([workspaceId])
  @@index([companyId])
  @@index([personId])
  @@index([workspaceId, receivedAt])
  @@index([from])
}

model OasisExternalConnection {
  id                                                  String     @id
  userId                                              String     @db.VarChar(30)
  externalUserId                                      String     @db.VarChar(30)
  externalWorkspaceId                                 String     @db.VarChar(30)
  status                                              String     @default("pending")
  createdAt                                           DateTime   @default(now())
  updatedAt                                           DateTime
  users_OasisExternalConnection_externalUserIdTousers users      @relation("OasisExternalConnection_externalUserIdTousers", fields: [externalUserId], references: [id], onDelete: Cascade)
  workspaces                                          workspaces @relation(fields: [externalWorkspaceId], references: [id], onDelete: Cascade)
  users_OasisExternalConnection_userIdTousers         users      @relation("OasisExternalConnection_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, externalUserId, externalWorkspaceId])
  @@index([externalUserId])
  @@index([externalWorkspaceId])
  @@index([status])
  @@index([userId])
}

/// Workshop Document Management System
model workshopDocument {
  id                String   @id @default(ulid())
  title             String   @db.VarChar(500)
  description       String?
  content           Json?
  fileUrl           String?  @db.VarChar(1000)
  fileType          String   @default("text/plain") @db.VarChar(100)
  fileSize          Int?
  documentType      String   @default("paper") @db.VarChar(20) // paper, pitch, grid, code, matrix
  status            String   @default("draft") @db.VarChar(20) // draft, published, archived, deleted
  version           String   @default("1.0") @db.VarChar(20)
  
  // Security & Classification
  isEncrypted       Boolean  @default(false)
  classification    String   @default("internal") @db.VarChar(50)
  requiresAuth      Boolean  @default(true)
  
  // Organization
  folderId          String?  @db.VarChar(30)
  tags              String[] @default([])
  isStarred         Boolean  @default(false)
  isTemplate        Boolean  @default(false)
  
  // Ownership & Workspace
  ownerId           String   @db.VarChar(30)
  workspaceId       String   @db.VarChar(30)
  companyId         String?  @db.VarChar(30)
  
  // Analytics
  viewCount         Int      @default(0)
  downloadCount     Int      @default(0)
  lastAccessedAt    DateTime?
  
  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  publishedAt       DateTime?
  archivedAt        DateTime?
  deletedAt         DateTime?
  
  // Report-specific fields (for Chronicle integration)
  reportType        String?  @db.VarChar(50)
  sourceRecordId    String?  @db.VarChar(30)
  sourceRecordType  String?  @db.VarChar(50)
  generatedByAI     Boolean  @default(false)
  metadata          Json     @default("{}")
  createdById       String   @db.VarChar(30)
  
  // Relations
  owner             users    @relation("WorkshopDocumentOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  workspace         workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  company           companies? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy         users    @relation("WorkshopDocumentCreatedBy", fields: [createdById], references: [id], onDelete: Cascade)
  folder            workshopFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  shares            workshopShare[]
  versions          workshopVersion[]
  comments          workshopComment[]
  activities        workshopActivity[]

  @@index([workspaceId])
  @@index([ownerId])
  @@index([companyId])
  @@index([folderId])
  @@index([documentType])
  @@index([status])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([workspaceId, documentType])
  @@index([workspaceId, status])
  @@index([reportType])
  @@index([sourceRecordType, sourceRecordId])
}

model workshopFolder {
  id          String   @id @default(ulid())
  name        String   @db.VarChar(255)
  description String?
  parentId    String?  @db.VarChar(30)
  workspaceId String   @db.VarChar(30)
  ownerId     String   @db.VarChar(30)
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  
  // Relations
  parent      workshopFolder? @relation("WorkshopFolderParent", fields: [parentId], references: [id], onDelete: Cascade)
  children    workshopFolder[] @relation("WorkshopFolderParent")
  workspace   workspaces @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  owner       users    @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  documents   workshopDocument[]

  @@index([workspaceId])
  @@index([parentId])
  @@index([ownerId])
  @@index([deletedAt])
}

model workshopShare {
  id          String    @id @default(ulid())
  documentId  String    @db.VarChar(30)
  shareToken  String    @unique @db.VarChar(100)
  shareUrl    String?   @db.VarChar(500)
  permissions String[]  @default(["READ"]) // READ, WRITE, COMMENT
  expiresAt   DateTime?
  viewCount   Int       @default(0)
  isActive    Boolean   @default(true)
  createdById String    @db.VarChar(30)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  document    workshopDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  createdBy   users    @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([shareToken])
  @@index([expiresAt])
  @@index([isActive])
}

model workshopVersion {
  id                String   @id @default(ulid())
  documentId        String   @db.VarChar(30)
  versionNumber     Int
  content           Json?
  contentHash       String?  @db.VarChar(64)
  changeDescription String?  @db.VarChar(500)
  createdById       String   @db.VarChar(30)
  createdAt         DateTime @default(now())
  
  // Relations
  document          workshopDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  createdBy         users    @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([documentId, versionNumber])
  @@index([documentId])
  @@index([createdAt])
}

model workshopComment {
  id          String   @id @default(ulid())
  documentId  String   @db.VarChar(30)
  parentId    String?  @db.VarChar(30)
  content     String   @db.Text
  createdById String   @db.VarChar(30)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  
  // Relations
  document    workshopDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  parent      workshopComment? @relation("WorkshopCommentParent", fields: [parentId], references: [id], onDelete: Cascade)
  replies     workshopComment[] @relation("WorkshopCommentParent")
  createdBy   users    @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([parentId])
  @@index([createdAt])
  @@index([deletedAt])
}

model workshopActivity {
  id            String   @id @default(ulid())
  documentId    String   @db.VarChar(30)
  activityType  String   @db.VarChar(50) // CREATED, UPDATED, VIEWED, SHARED, COMMENTED, DELETED
  description   String?  @db.VarChar(500)
  metadata      Json?    @default("{}")
  performedById String   @db.VarChar(30)
  createdAt     DateTime @default(now())
  
  // Relations
  document      workshopDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  performedBy   users    @relation(fields: [performedById], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([activityType])
  @@index([createdAt])
  @@index([performedById])
}

enum UserRole {
  SUPER_ADMIN
  WORKSPACE_ADMIN
  MANAGER
  SELLER
  VIEWER
}

enum Permission {
  WORKSPACE_CREATE
  WORKSPACE_UPDATE
  WORKSPACE_DELETE
  WORKSPACE_VIEW
  USER_CREATE
  USER_UPDATE
  USER_DELETE
  USER_VIEW
  COMPANY_CREATE
  COMPANY_UPDATE
  COMPANY_DELETE
  COMPANY_VIEW
  PERSON_CREATE
  PERSON_UPDATE
  PERSON_DELETE
  PERSON_VIEW
  ACTION_CREATE
  ACTION_UPDATE
  ACTION_DELETE
  ACTION_VIEW
  AUDIT_VIEW
  AUDIT_EXPORT
  OASIS_ACCESS
  STACKS_ACCESS
  WORKSHOP_ACCESS
  REVENUEOS_ACCESS
  METRICS_ACCESS
  CHRONICLE_ACCESS
  DESKTOP_DOWNLOAD_ACCESS
}

enum ActionStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ActionPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum CompanyStatus {
  LEAD
  PROSPECT
  OPPORTUNITY
  CLIENT
  SUPERFAN
  ACTIVE
  INACTIVE
}

enum CompanyPriority {
  LOW
  MEDIUM
  HIGH
}

enum PersonStatus {
  LEAD
  PROSPECT
  OPPORTUNITY
  CLIENT
  PARTNER
  SUPERFAN
}

enum PersonPriority {
  LOW
  MEDIUM
  HIGH
}

enum BuyerGroupRole {
  decision
  champion
  stakeholder
  blocker
  introducer
}

enum ChronicleReportType {
  MONDAY_PREP
  FRIDAY_RECAP
}

enum MessageType {
  USER
  ASSISTANT
}
