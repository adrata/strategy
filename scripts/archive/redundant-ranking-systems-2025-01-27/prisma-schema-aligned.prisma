// =====================================================
// RANKING EVENTS PRISMA SCHEMA - ALIGNED WITH EXISTING MODELS
// =====================================================
// Add these models to your existing schema.prisma file
// Aligned with existing patterns: ulid(), VarChar(30), Timestamp(6), etc.
// =====================================================

model RankingEvent {
  id          String   @id @default(ulid()) @db.VarChar(30)
  workspaceId String   @db.VarChar(30)
  userId      String   @db.VarChar(30)
  eventType   String   @db.VarChar(50)
  entityType  String   @db.VarChar(50)
  entityId    String   @db.VarChar(30)
  eventData   Json?
  impactScore Int      @default(0)
  priority    Int      @default(3)
  processed   Boolean  @default(false)
  processedAt DateTime? @db.Timestamp(6)
  errorMessage String?
  retryCount  Int      @default(0)
  createdAt   DateTime @default(now()) @db.Timestamp(6)

  @@index([workspaceId])
  @@index([userId])
  @@index([eventType])
  @@index([entityType])
  @@index([entityId])
  @@index([processed])
  @@index([priority])
  @@index([createdAt])
  @@index([workspaceId, processed])
  @@map("ranking_events")
}

model RankingScore {
  id           String   @id @default(ulid()) @db.VarChar(30)
  workspaceId  String   @db.VarChar(30)
  entityType   String   @db.VarChar(50) // people, leads, opportunities, companies, prospects
  entityId     String   @db.VarChar(30)
  score        Int
  rankPosition Int
  factors      Json?
  lastUpdated  DateTime @default(now()) @db.Timestamp(6)
  createdAt    DateTime @default(now()) @db.Timestamp(6)

  @@unique([workspaceId, entityType, entityId])
  @@index([workspaceId])
  @@index([entityType])
  @@index([entityId])
  @@index([score])
  @@index([rankPosition])
  @@index([workspaceId, entityType])
  @@index([lastUpdated])
  @@map("ranking_scores")
}

model RankingMetric {
  id                    String   @id @default(ulid()) @db.VarChar(30)
  workspaceId          String   @db.VarChar(30)
  date                 DateTime @db.Date
  totalEvents          Int      @default(0)
  processedEvents      Int      @default(0)
  failedEvents         Int      @default(0)
  averageProcessingTime Float    @default(0)
  queueSize            Int      @default(0)
  createdAt            DateTime @default(now()) @db.Timestamp(6)

  @@unique([workspaceId, date])
  @@index([workspaceId])
  @@index([date])
  @@index([workspaceId, date])
  @@map("ranking_metrics")
}
