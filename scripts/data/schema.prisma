generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model ProviderToken {
  id                  String             @id @default(uuid())
  provider            String
  accessToken         String
  refreshToken        String?
  expiresAt           DateTime?
  workspaceId         String
  connectedProviderId String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  connectedProvider   ConnectedProvider? @relation(fields: [connectedProviderId], references: [id])
  workspace           Workspace          @relation(fields: [workspaceId], references: [id])

  @@unique([workspaceId, provider])
}

model ConnectedProvider {
  id          String          @id @default(uuid())
  provider    String
  email       String
  workspaceId String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  workspace   Workspace       @relation(fields: [workspaceId], references: [id])
  emails      Email[]
  tokens      ProviderToken[]

  @@unique([workspaceId, provider, email])
}

model Email {
  id                 String              @id @default(uuid())
  messageId          String
  threadId           String?
  subject            String
  body               String
  from               String
  to                 String[]
  cc                 String[]
  bcc                String[]
  receivedAt         DateTime
  providerId         String
  workspaceId        String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  provider           ConnectedProvider   @relation(fields: [providerId], references: [id])
  workspace          Workspace           @relation(fields: [workspaceId], references: [id])
  events             Event[]
  meetings           Meeting[]
  pipelineExecutions PipelineExecution[] @relation("EmailToPipelineExecution")

  @@unique([providerId, messageId])
}

model Meeting {
  id           String    @id @default(uuid())
  title        String
  startTime    DateTime
  endTime      DateTime
  participants String[]
  emailId      String
  workspaceId  String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  email        Email     @relation(fields: [emailId], references: [id])
  workspace    Workspace @relation(fields: [workspaceId], references: [id])
}

model Event {
  id          String    @id @default(uuid())
  title       String
  startTime   DateTime
  endTime     DateTime
  location    String?
  emailId     String
  workspaceId String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  email       Email     @relation(fields: [emailId], references: [id])
  workspace   Workspace @relation(fields: [workspaceId], references: [id])
}

model SellerProfile {
  id                 String              @id @default(uuid())
  name               String
  industry           String?
  size               String?
  website            String?
  description        String?
  workspaceId        String
  companyId          String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  contacts           Person[]
  pipelineExecutions PipelineExecution[]
  company            Company?            @relation(fields: [companyId], references: [id])
  workspace          Workspace           @relation(fields: [workspaceId], references: [id])
}

model BuyerCompanyProfile {
  id          String       @id @default(uuid())
  name        String
  industry    String?
  size        String?
  website     String?
  description String?
  workspaceId String
  companyId   String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  company     Company?     @relation(fields: [companyId], references: [id])
  workspace   Workspace    @relation(fields: [workspaceId], references: [id])
  groups      BuyerGroup[]
}

model Person {
  id                      String                   @id @default(uuid())
  name                    String
  email                   String?
  title                   String?
  role                    String?
  sellerProfileId         String?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  bio                     String?
  createdBy               String?
  dataSource              String                   @default("manual")
  department              String?
  doNotCall               Boolean                  @default(false)
  emailOptOut             Boolean                  @default(false)
  firstName               String
  fullName                String
  gdprConsent             Boolean                  @default(false)
  githubUsername          String?
  isVerified              Boolean                  @default(false)
  lastEnriched            DateTime?
  lastName                String
  linkedinUrl             String?
  location                String?
  mobile                  String?
  personalEmail           String?
  personalWebsite         String?
  phone                   String?
  photoUrl                String?
  previousCompanies       String[]
  seniority               String?
  timezone                String?
  twitterHandle           String?
  workspaceId             String
  contacts                Contact[]
  decisionMakers          DecisionMaker[]
  leads                   Lead[]
  opportunityStakeholders OpportunityStakeholder[]
  creator                 User?                    @relation("PersonCreator", fields: [createdBy], references: [id])
  sellerProfile           SellerProfile?           @relation(fields: [sellerProfileId], references: [id])
  workspace               Workspace                @relation("WorkspacePeople", fields: [workspaceId], references: [id], onDelete: Cascade)
  groups                  BuyerGroup[]             @relation("BuyerGroupToPerson")

  @@unique([email, workspaceId])
  @@index([workspaceId, fullName])
  @@index([workspaceId, email])
  @@index([dataSource, isVerified])
}

model BuyerGroup {
  id             String              @id @default(uuid())
  name           String
  description    String?
  companyId      String
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  company        BuyerCompanyProfile @relation(fields: [companyId], references: [id])
  decisionMakers DecisionMaker[]
  members        Person[]            @relation("BuyerGroupToPerson")
}

model DecisionMaker {
  id        String     @id @default(uuid())
  role      String
  personId  String
  groupId   String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  group     BuyerGroup @relation(fields: [groupId], references: [id])
  person    Person     @relation(fields: [personId], references: [id])
}

model PipelineExecution {
  id              String              @id @default(uuid())
  status          String
  startedAt       DateTime
  completedAt     DateTime?
  sellerProfileId String
  workspaceId     String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  report          IntelligenceReport?
  sellerProfile   SellerProfile       @relation(fields: [sellerProfileId], references: [id])
  workspace       Workspace           @relation(fields: [workspaceId], references: [id])
  steps           PipelineStep[]
  emails          Email[]             @relation("EmailToPipelineExecution")
}

model PipelineStep {
  id          String            @id @default(uuid())
  name        String
  status      String
  startedAt   DateTime?
  completedAt DateTime?
  error       String?
  executionId String
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  execution   PipelineExecution @relation(fields: [executionId], references: [id])
}

model IntelligenceReport {
  id          String            @id @default(uuid())
  content     Json
  executionId String            @unique
  workspaceId String
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  execution   PipelineExecution @relation(fields: [executionId], references: [id])
  workspace   Workspace         @relation(fields: [workspaceId], references: [id])
}

model User {
  id       String  @id @default(cuid())
  email    String  @unique
  password String?

  name        String  @db.Text
  firstName   String? @db.Text
  lastName    String? @db.Text
  displayName String? @db.Text
  username    String? @db.Text

  preferredLanguage String  @default("en") @db.VarChar(10)
  countryCode       String? @db.VarChar(2)
  timezone          String? @db.VarChar(50)
  locale            String? @db.VarChar(10)

  textDirection String @default("ltr") @db.VarChar(3)

  address    String? @db.Text
  city       String? @db.Text
  state      String? @db.Text
  country    String? @db.Text
  postalCode String? @db.VarChar(20)

  bio   String? @db.Text
  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspaces    WorkspaceUser[]
  leads         Lead[]
  createdLeads  Lead[]         @relation("LeadCreator")
  assignedLeads Lead[]         @relation("LeadAssignee")
  opportunities Opportunity[]
  ownedOpportunities        Opportunity[] @relation("OpportunityOwner")
  assignedOpportunities     Opportunity[] @relation("OpportunityAssignee")
  createdOpportunities      Opportunity[] @relation("OpportunityCreator")
  userNotes     Note[]          @relation("userNotes")
  activities    Activity[]

  // Recruiting relations
  candidatesRecruited Candidate[] @relation("CandidateRecruiter")
  jobsRecruited       Job[]       @relation("JobRecruiter")

  // Agency relations
  agencyWorkspacesOwned AgencyWorkspace[] @relation("AgencyOwner")
  agencyMemberships     AgencyUser[]      @relation("AgencyUser")
  clientMemberships     ClientUser[]      @relation("ClientUser")

  // Partnership relations
  partnershipsCreated  Partnership[] @relation("PartnershipCreator")
  partnershipsAssigned Partnership[] @relation("PartnershipAssignee")

  // Product portfolio relations
  productPortfolios SellerProductPortfolio[] @relation("SellerProducts")

  // Opportunity activity relations
  hostedActivities OpportunityActivity[] @relation("ActivityHost")

  // Person creator relations
  peopleCreated Person[] @relation("PersonCreator")

  // Enrichment relations
  enrichmentExecutions EnrichmentExecution[] @relation("EnrichmentUser")

  // Chat and messaging relations
  chatMembers      ChatMember[]
  sentMessages     Message[]         @relation("MessageSender")
  messageReactions MessageReaction[]

  // Document ownership relations
  ownedPapers    Paper[]
  ownedGrids     Grid[]
  ownedPitches   Pitch[]
  documentShares DocumentShare[]

  // App relations
  userApps UserApp[]

  // Security and audit relations
  auditLogs        AuditLog[]
  securityEvents   SecurityEvent[]
  dataTransferLogs DataTransferLog[]

  // Outbox relations
  outboxSettings OutboxSettings[]

  // Additional assignments  
  assignedContacts Contact[]
  assignedAccounts Account[]

  // Workspace memberships
  workspaceMemberships WorkspaceMembership[]

  // Channel partner relations
  managedChannelPartners ChannelPartner[]      @relation("PartnerAccountManager")
  providedEnablement     PartnerEnablement[]   @relation("EnablementProvider")

  // Vault and document signing relations
  vaultDocuments          VaultDocument[]
  dataRooms               DataRoom[]
  dueDiligenceChecklists  DueDiligenceChecklist[]
  dueDiligenceAssignments DueDiligenceItem[]

  @@index([email])
  @@index([preferredLanguage])
  @@index([countryCode])
  @@map("users")
}

model Company {
  id             String                @id @default(uuid())
  name           String
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  buyerProfiles  BuyerCompanyProfile[]
  grids          Grid[]
  papers         Paper[]
  pitches        Pitch[]
  sellerProfiles SellerProfile[]
  workspaces     Workspace[]

  // Vault and due diligence relations
  vaultDocuments          VaultDocument[]
  dataRooms               DataRoom[]
  dueDiligenceChecklists  DueDiligenceChecklist[]
}

model Workspace {
  id   String @id @default(cuid())
  name String @db.Text
  slug String @unique

  defaultLanguage    String   @default("en") @db.VarChar(10)
  supportedLanguages String[] @default(["en"])
  timezone           String   @default("UTC") @db.VarChar(50)

  description String? @db.Text

  currency     String @default("USD") @db.VarChar(3)
  dateFormat   String @default("MM/dd/yyyy") @db.VarChar(20)
  numberFormat String @default("1,234.56") @db.VarChar(20)
  
  subscriptionTier   String? @db.VarChar(20)
  subscriptionStatus String? @db.VarChar(20)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users          WorkspaceUser[]
  leads          Lead[]
  opportunities  Opportunity[]
  accounts       Account[]
  contacts       Contact[]
  workspaceNotes Note[]
  activities     Activity[]

  // Additional relations
  grids    Grid[]
  papers   Paper[]
  pitches  Pitch[]
  chats    Chat[]
  emails   Email[]
  meetings Meeting[]
  events   Event[]
  shares   DocumentShare[]

  // Intelligence and pipeline relations
  sellerProfiles       SellerProfile[]
  buyerCompanyProfiles BuyerCompanyProfile[]
  people               Person[]              @relation("WorkspacePeople")
  pipelineExecutions   PipelineExecution[]
  intelligenceReports  IntelligenceReport[]

  // Enrichment relations
  enrichmentExecutions EnrichmentExecution[] @relation("WorkspaceEnrichments")
  enrichmentCache      EnrichmentCache[]     @relation("WorkspaceEnrichmentCache")

  // Partnership relations
  partnerships Partnership[] @relation("WorkspacePartnerships")

  // Product portfolio relations
  sellerProductPortfolios SellerProductPortfolio[] @relation("WorkspaceSellerProducts")

  // Provider relations
  providerTokens     ProviderToken[]
  connectedProviders ConnectedProvider[]

  // App relations
  workspaceApps WorkspaceApp[]

  // Recruiting relations
  candidates Candidate[] @relation("WorkspaceCandidates")
  jobs       Job[]       @relation("WorkspaceJobs")

  // Agency relations (as client)
  clientAccounts ClientAccount[] @relation("ClientWorkspace")

  // Security and management relations
  ssoProviders       SSOProvider[]
  roles              Role[]
  auditLogs          AuditLog[]
  scimConnections    SCIMConnection[]
  scimSyncOperations SCIMSyncOperation[]
  securityEvents     SecurityEvent[]
  securityMetrics    SecurityMetrics[]
  workspaceRegions   WorkspaceRegion[]
  dataTransferLogs   DataTransferLog[]
  outboxSettings     OutboxSettings[]

  // Workspace memberships
  workspaceMemberships WorkspaceMembership[]

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?
  Bundle    Bundle?  @relation(fields: [bundleId], references: [id])
  bundleId  String?
  
  // Nightlife integration relations
  nightlifeEvents       NightlifeEvent[]        @relation("WorkspaceNightlifeEvents")

  // Channel partner relations
  channelPrograms        ChannelPartnerProgram[] @relation("WorkspaceChannelPrograms")
  channelPartners        ChannelPartner[]        @relation("WorkspaceChannelPartners")
  channelProducts        ChannelPartnerProduct[] @relation("WorkspaceChannelProducts")
  productBundles         ProductBundle[]         @relation("WorkspaceProductBundles")
  channelSales           ChannelSale[]           @relation("WorkspaceChannelSales")
  partnerEnablement      PartnerEnablement[]     @relation("WorkspacePartnerEnablement")

  // Vault and due diligence relations
  vaultDocuments          VaultDocument[]
  dataRooms               DataRoom[]
  dueDiligenceChecklists  DueDiligenceChecklist[]

  @@index([slug])
  @@index([defaultLanguage])
  @@map("workspaces")
}

model WorkspaceMembership {
  id             String          @id @default(uuid())
  userId         String
  workspaceId    String
  role           String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  invitedBy      String?
  isActive       Boolean         @default(true)
  joinedAt       DateTime?
  roleId         String?
  membershipApps MembershipApp[]
  assignedRole   Role?           @relation(fields: [roleId], references: [id])
  user           User            @relation(fields: [userId], references: [id])
  workspace      Workspace       @relation(fields: [workspaceId], references: [id])
}

model App {
  id             String          @id @default(uuid())
  name           String
  slug           String          @unique
  description    String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  bundles        BundleApp[]
  grids          Grid[]
  membershipApps MembershipApp[]
  papers         Paper[]
  pitches        Pitch[]
  userApps       UserApp[]
  workspaces     WorkspaceApp[]
}

model WorkspaceApp {
  id          String    @id @default(uuid())
  workspaceId String
  appId       String
  enabled     Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  app         App       @relation(fields: [appId], references: [id])
  workspace   Workspace @relation(fields: [workspaceId], references: [id])
}

model Bundle {
  id         String      @id @default(uuid())
  name       String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  apps       BundleApp[]
  workspaces Workspace[]
}

model BundleApp {
  id       String @id @default(uuid())
  bundleId String
  appId    String
  app      App    @relation(fields: [appId], references: [id])
  bundle   Bundle @relation(fields: [bundleId], references: [id])
}

model Paper {
  id          String          @id @default(uuid())
  title       String
  content     Json
  appId       String
  ownerId     String
  companyId   String?
  workspaceId String?
  sharable    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  shares      DocumentShare[]
  app         App             @relation(fields: [appId], references: [id])
  company     Company?        @relation(fields: [companyId], references: [id])
  owner       User            @relation(fields: [ownerId], references: [id])
  workspace   Workspace?      @relation(fields: [workspaceId], references: [id])

  // New signing relation
  signatures      DocumentSignature[]
}

model Grid {
  id          String          @id @default(uuid())
  title       String
  content     Json
  appId       String
  ownerId     String
  companyId   String?
  workspaceId String?
  sharable    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  shares      DocumentShare[]
  app         App             @relation(fields: [appId], references: [id])
  company     Company?        @relation(fields: [companyId], references: [id])
  owner       User            @relation(fields: [ownerId], references: [id])
  workspace   Workspace?      @relation(fields: [workspaceId], references: [id])
}

model Pitch {
  id          String          @id @default(uuid())
  title       String
  content     Json
  appId       String
  ownerId     String
  companyId   String?
  workspaceId String?
  sharable    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  shares      DocumentShare[]
  app         App             @relation(fields: [appId], references: [id])
  company     Company?        @relation(fields: [companyId], references: [id])
  owner       User            @relation(fields: [ownerId], references: [id])
  workspace   Workspace?      @relation(fields: [workspaceId], references: [id])
}

model DocumentShare {
  id          String         @id @default(uuid())
  paperId     String?
  gridId      String?
  pitchId     String?
  vaultDocId  String?
  userId      String?
  workspaceId String?
  createdAt   DateTime       @default(now())
  grid        Grid?          @relation(fields: [gridId], references: [id])
  paper       Paper?         @relation(fields: [paperId], references: [id])
  pitch       Pitch?         @relation(fields: [pitchId], references: [id])
  vaultDoc    VaultDocument? @relation(fields: [vaultDocId], references: [id])
  user        User?          @relation(fields: [userId], references: [id])
  workspace   Workspace?     @relation(fields: [workspaceId], references: [id])
}

model UserApp {
  id          String   @id @default(uuid())
  userId      String
  appId       String
  installedAt DateTime @default(now())
  app         App      @relation(fields: [appId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@unique([userId, appId])
}

model MembershipApp {
  id           String              @id @default(uuid())
  membershipId String
  appId        String
  enabled      Boolean             @default(true)
  installedAt  DateTime            @default(now())
  app          App                 @relation(fields: [appId], references: [id])
  membership   WorkspaceMembership @relation(fields: [membershipId], references: [id])

  @@unique([membershipId, appId])
}

model Chat {
  id          String       @id @default(uuid())
  type        String
  name        String?
  description String?
  workspaceId String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  workspace   Workspace?   @relation(fields: [workspaceId], references: [id])
  members     ChatMember[]
  messages    Message[]

  @@index([type])
  @@index([workspaceId])
}

model ChatMember {
  id       String   @id @default(uuid())
  chatId   String
  userId   String
  role     String   @default("member")
  joinedAt DateTime @default(now())
  chat     Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chatId, userId])
  @@index([userId])
}

model Message {
  id        String            @id @default(uuid())
  content   String
  chatId    String
  senderId  String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  chat      Chat              @relation(fields: [chatId], references: [id])
  sender    User              @relation("MessageSender", fields: [senderId], references: [id])
  reactions MessageReaction[]

  @@index([chatId])
  @@index([senderId])
}

model MessageReaction {
  id        String   @id @default(uuid())
  emoji     String
  messageId String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  message   Message  @relation(fields: [messageId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([messageId, userId, emoji])
  @@index([messageId])
  @@index([userId])
}

model SSOProvider {
  id            String    @id @default(uuid())
  name          String
  type          String
  workspaceId   String
  entityId      String?
  ssoUrl        String?
  certificate   String?
  clientId      String?
  clientSecret  String?
  issuer        String?
  isActive      Boolean   @default(true)
  autoProvision Boolean   @default(true)
  defaultRole   String    @default("member")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  workspace     Workspace @relation(fields: [workspaceId], references: [id])

  @@unique([workspaceId, name])
}

model Role {
  id          String                @id @default(uuid())
  name        String
  displayName String
  description String?
  workspaceId String
  isSystem    Boolean               @default(false)
  permissions String[]
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  workspace   Workspace             @relation(fields: [workspaceId], references: [id])
  memberships WorkspaceMembership[]

  @@unique([workspaceId, name])
}

model AuditLog {
  id           String    @id @default(uuid())
  userId       String?
  workspaceId  String
  timestamp    DateTime  @default(now())
  action       String
  resource     String?
  resourceType String?
  details      Json?
  ipAddress    String?
  userAgent    String?
  platform     String?
  category     String
  severity     String    @default("info")
  user         User?     @relation(fields: [userId], references: [id])
  workspace    Workspace @relation(fields: [workspaceId], references: [id])

  @@index([workspaceId, timestamp])
  @@index([userId, timestamp])
  @@index([action])
  @@index([category])
}

model SCIMConnection {
  id             String              @id @default(uuid())
  name           String
  workspaceId    String
  baseUrl        String
  bearerToken    String?
  clientId       String?
  clientSecret   String?
  isActive       Boolean             @default(true)
  syncInterval   Int                 @default(3600)
  lastSyncAt     DateTime?
  nextSyncAt     DateTime?
  enableCreate   Boolean             @default(true)
  enableUpdate   Boolean             @default(true)
  enableDelete   Boolean             @default(false)
  enableGroups   Boolean             @default(true)
  userMapping    Json
  groupMapping   Json
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  workspace      Workspace           @relation(fields: [workspaceId], references: [id])
  syncOperations SCIMSyncOperation[]

  @@unique([workspaceId, name])
}

model SCIMSyncOperation {
  id               String         @id @default(uuid())
  connectionId     String
  workspaceId      String
  operationType    String
  status           String
  startedAt        DateTime       @default(now())
  completedAt      DateTime?
  usersProcessed   Int            @default(0)
  usersCreated     Int            @default(0)
  usersUpdated     Int            @default(0)
  usersDeactivated Int            @default(0)
  groupsProcessed  Int            @default(0)
  errorsCount      Int            @default(0)
  errors           Json?
  summary          Json?
  connection       SCIMConnection @relation(fields: [connectionId], references: [id])
  workspace        Workspace      @relation(fields: [workspaceId], references: [id])

  @@index([workspaceId, startedAt])
  @@index([connectionId, startedAt])
}

model SecurityEvent {
  id            String    @id @default(uuid())
  workspaceId   String
  userId        String?
  eventType     String
  severity      String
  category      String
  description   String
  details       Json
  sourceIp      String?
  userAgent     String?
  platform      String?
  location      String?
  riskScore     Float     @default(0.0)
  isAnomaly     Boolean   @default(false)
  isResolved    Boolean   @default(false)
  resolvedAt    DateTime?
  resolvedBy    String?
  relatedEvents String[]
  timestamp     DateTime  @default(now())
  user          User?     @relation(fields: [userId], references: [id])
  workspace     Workspace @relation(fields: [workspaceId], references: [id])

  @@index([workspaceId, timestamp])
  @@index([eventType, severity])
  @@index([isAnomaly, isResolved])
}

model SecurityMetrics {
  id                String    @id @default(uuid())
  workspaceId       String
  period            String
  periodStart       DateTime
  periodEnd         DateTime
  totalLogins       Int       @default(0)
  failedLogins      Int       @default(0)
  ssoLogins         Int       @default(0)
  passwordLogins    Int       @default(0)
  activeUsers       Int       @default(0)
  newUsers          Int       @default(0)
  deactivatedUsers  Int       @default(0)
  roleChanges       Int       @default(0)
  permissionGrants  Int       @default(0)
  permissionRevokes Int       @default(0)
  securityEvents    Int       @default(0)
  highRiskEvents    Int       @default(0)
  resolvedEvents    Int       @default(0)
  securityScore     Float     @default(0.0)
  riskLevel         String    @default("low")
  metrics           Json
  createdAt         DateTime  @default(now())
  workspace         Workspace @relation(fields: [workspaceId], references: [id])

  @@unique([workspaceId, period, periodStart])
  @@index([workspaceId, periodStart])
}

model DataRegion {
  id                   String            @id @default(uuid())
  name                 String
  code                 String            @unique
  country              String
  region               String
  regulations          String[]
  dataClassifications  String[]
  isActive             Boolean           @default(true)
  isPrimary            Boolean           @default(false)
  backupRegions        String[]
  defaultRetentionDays Int               @default(365)
  maxRetentionDays     Int               @default(2555)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  workspaceRegions     WorkspaceRegion[]

  @@index([country])
  @@index([isActive])
}

model WorkspaceRegion {
  id                   String     @id @default(uuid())
  workspaceId          String
  regionId             String
  isPrimary            Boolean    @default(false)
  isBackup             Boolean    @default(false)
  dataTypes            String[]
  accessRules          Json
  auditRetentionDays   Int        @default(365)
  complianceFrameworks String[]
  allowDataExport      Boolean    @default(false)
  exportApprovers      String[]
  createdAt            DateTime   @default(now())
  updatedAt            DateTime   @updatedAt
  region               DataRegion @relation(fields: [regionId], references: [id])
  workspace            Workspace  @relation(fields: [workspaceId], references: [id])

  @@unique([workspaceId, regionId])
}

model DataTransferLog {
  id              String    @id @default(uuid())
  workspaceId     String
  userId          String?
  transferType    String
  sourceRegion    String
  targetRegion    String
  dataType        String
  requestedBy     String
  approvedBy      String?
  approvedAt      DateTime?
  status          String
  startedAt       DateTime?
  completedAt     DateTime?
  recordCount     Int?
  dataSize        Int?
  checksum        String?
  legalBasis      String?
  retentionPeriod Int?
  errorMessage    String?
  retryCount      Int       @default(0)
  details         Json?
  timestamp       DateTime  @default(now())
  user            User?     @relation(fields: [userId], references: [id])
  workspace       Workspace @relation(fields: [workspaceId], references: [id])

  @@index([workspaceId, timestamp])
  @@index([sourceRegion, targetRegion])
  @@index([status, transferType])
}

model OutboxSettings {
  id             String     @id @default(uuid())
  userId         String
  workspaceId    String?
  weeklyTarget   Int        @default(15)
  strategy       String     @default("optimal")
  role           String     @default("AE")
  quota          Int?
  pipelineHealth String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace      Workspace? @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId])
  @@index([userId])
}

model Lead {
  id             String  @id @default(cuid())
  workspaceId    String  @db.VarChar(30)
  assignedUserId String? @db.VarChar(30)
  assignedTo     String? @db.VarChar(30) // Legacy field for compatibility
  createdBy      String? @db.VarChar(30)

  firstName   String  @db.Text
  lastName    String  @db.Text
  fullName    String  @db.Text
  displayName String? @db.Text

  email       String? @db.Text
  phone       String? @db.Text
  mobilePhone String? @db.Text
  workPhone   String? @db.Text

  company    String? @db.Text
  jobTitle   String? @db.Text
  department String? @db.Text
  
  linkedinUrl   String? @db.Text
  twitterHandle String? @db.Text
  skypeId       String? @db.Text
  website       String? @db.Text
  fax           String? @db.Text
  vatNumber     String? @db.Text
  industry      String? @db.Text
  annualRevenue Float?
  employeeCount Int?

  address    String? @db.Text
  city       String? @db.Text
  state      String? @db.Text
  country    String? @db.Text
  postalCode String? @db.VarChar(20)

  status   String  @default("new") @db.VarChar(20)
  priority String  @default("medium") @db.VarChar(10)
  source   String? @db.Text

  estimatedValue Float?
  currency       String @default("USD") @db.VarChar(3)

  notes       String? @db.Text
  description String? @db.Text

  tags         String[] @default([])
  customFields Json?    @db.JsonB

  preferredLanguage String? @db.VarChar(10)
  timezone          String? @db.VarChar(50)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace     Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  assignedUser  User?         @relation(fields: [assignedUserId], references: [id])
  creator       User?         @relation("LeadCreator", fields: [createdBy], references: [id])
  assignee      User?         @relation("LeadAssignee", fields: [assignedTo], references: [id])
  opportunities Opportunity[]
  leadNotes     Note[]        @relation("leadNotes")
  activities    Activity[]

  // Additional relations
  partnershipLeads PartnershipLead[]

  Person   Person? @relation(fields: [personId], references: [id])
  personId String?

  @@unique([email, workspaceId], name: "lead_email_workspace")
  @@index([workspaceId])
  @@index([assignedUserId])
  @@index([email])
  @@index([company])
  @@index([status])
  @@index([preferredLanguage])
  @@index([country])
  @@map("leads")
}

model Contact {
  id             String  @id @default(cuid())
  workspaceId    String  @db.VarChar(30)
  accountId      String? @db.VarChar(30)
  assignedUserId String? @db.VarChar(30)

  firstName   String  @db.Text
  lastName    String  @db.Text
  middleName  String? @db.Text
  fullName    String  @db.Text
  displayName String? @db.Text
  salutation  String? @db.Text
  suffix      String? @db.Text

  jobTitle   String? @db.Text
  department String? @db.Text
  seniority  String? @db.VarChar(20)
  company    String? @db.Text

  email          String? @db.Text
  secondaryEmail String? @db.Text
  phone          String? @db.Text
  mobilePhone    String? @db.Text
  workPhone      String? @db.Text

  linkedinUrl   String? @db.Text
  twitterHandle String? @db.Text

  address    String? @db.Text
  city       String? @db.Text
  state      String? @db.Text
  country    String? @db.Text
  postalCode String? @db.VarChar(20)

  dateOfBirth DateTime?
  gender      String?   @db.VarChar(20)

  notes       String? @db.Text
  bio         String? @db.Text
  description String? @db.Text
  
  source     String? @db.Text
  isVerified Boolean @default(false)

  tags         String[] @default([])
  customFields Json?    @db.JsonB

  preferredLanguage String? @db.VarChar(10)
  timezone          String? @db.VarChar(50)
  currency          String? @db.VarChar(3)

  status String @default("active") @db.VarChar(20)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace     Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  account       Account?      @relation(fields: [accountId], references: [id])
  assignedUser  User?         @relation(fields: [assignedUserId], references: [id])
  opportunities Opportunity[]
  primaryOpportunities Opportunity[] @relation("PrimaryOpportunityContact")
  contactNotes  Note[]        @relation("contactNotes")
  activities    Activity[]

  // Additional relations
  opportunityStakeholders OpportunityStakeholder[]

  Person   Person? @relation(fields: [personId], references: [id])
  personId String?

  @@unique([email, workspaceId], name: "email_workspaceId")
  @@index([workspaceId])
  @@index([accountId])
  @@index([assignedUserId])
  @@index([email])
  @@index([fullName])
  @@index([jobTitle])
  @@index([preferredLanguage])
  @@index([country])
  @@map("contacts")
}

model Opportunity {
  id             String  @id @default(cuid())
  workspaceId    String  @db.VarChar(30)
  leadId         String? @db.VarChar(30)
  accountId      String? @db.VarChar(30)
  assignedUserId String? @db.VarChar(30)
  ownerId        String? @db.VarChar(30)
  assignedTo     String? @db.VarChar(30)
  createdBy      String? @db.VarChar(30)
  primaryContactId String? @db.VarChar(30)

  name        String  @db.Text
  description String? @db.Text
  
  nextBestAction  String? @db.Text
  actionPriority  String? @db.VarChar(20)
  productCategory String? @db.VarChar(100)
  useCase         String? @db.Text

  amount      Float?
  currency    String @default("USD") @db.VarChar(3)
  probability Float? @default(0.5)
  
  engagementScore    Float? @default(0.5)
  technicalFitScore  Float? @default(0.5)
  aiConfidenceLevel  Float? @default(0.6)

  stage      String  @default("prospect") @db.VarChar(30)
  priority   String  @default("medium") @db.VarChar(10)
  source     String? @db.Text
  sourceType String? @db.VarChar(50)

  expectedCloseDate DateTime?
  actualCloseDate   DateTime?

  notes     String? @db.Text
  nextSteps String? @db.Text

  tags         String[] @default([])
  customFields Json?    @db.JsonB

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace        Workspace  @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  lead             Lead?      @relation(fields: [leadId], references: [id])
  account          Account?   @relation(fields: [accountId], references: [id])
  assignedUser     User?      @relation(fields: [assignedUserId], references: [id])
  owner            User?      @relation("OpportunityOwner", fields: [ownerId], references: [id])
  assignee         User?      @relation("OpportunityAssignee", fields: [assignedTo], references: [id])
  creator          User?      @relation("OpportunityCreator", fields: [createdBy], references: [id])
  primaryContact   Contact?   @relation("PrimaryOpportunityContact", fields: [primaryContactId], references: [id])
  contacts         Contact[]
  opportunityNotes Note[]     @relation("opportunityNotes")
  activities       Activity[]

  // Additional relations
  stakeholders          OpportunityStakeholder[]
  opportunityActivities OpportunityActivity[]

  @@index([workspaceId])
  @@index([leadId])
  @@index([accountId])
  @@index([assignedUserId])
  @@index([stage])
  @@index([currency])
  @@map("opportunities")
}

model OpportunityStakeholder {
  id                String      @id @default(uuid())
  opportunityId     String
  contactId         String?
  personId          String?
  name              String
  title             String?
  role              String
  influence         String      @default("Medium")
  engagementLevel   String      @default("Initial")
  lastContactDate   DateTime?
  contactFrequency  String      @default("Monthly")
  preferredChannel  String?
  responseRate      Float       @default(0.5)
  buyingProcessRole String?
  concerns          String?
  interests         String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  contact           Contact?    @relation(fields: [contactId], references: [id])
  opportunity       Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)
  person            Person?     @relation(fields: [personId], references: [id])

  @@unique([opportunityId, contactId])
  @@index([opportunityId, role])
  @@index([engagementLevel, influence])
}

model OpportunityActivity {
  id             String      @id @default(uuid())
  opportunityId  String
  type           String
  subject        String?
  description    String?
  outcome        String?
  duration       Int?
  attendeeCount  Int?
  qualityScore   Float?
  nextSteps      String?
  scheduledDate  DateTime?
  completedDate  DateTime?
  isCompleted    Boolean     @default(false)
  participantIds String[]
  hostId         String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  host           User?       @relation("ActivityHost", fields: [hostId], references: [id])
  opportunity    Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@index([opportunityId, type])
  @@index([completedDate])
  @@index([qualityScore])
}

model SellerProductPortfolio {
  id                   String    @id @default(uuid())
  sellerId             String
  workspaceId          String
  productName          String
  productCategory      String
  description          String?
  targetIndustries     String[]
  targetCompanySize    String[]
  primaryUseCases      String[]
  startingPrice        Decimal?  @db.Decimal(10, 2)
  averageDealSize      Decimal?  @db.Decimal(10, 2)
  maxDealSize          Decimal?  @db.Decimal(10, 2)
  typicalSalesCycle    Int?
  keyValueProps        String[]
  commonObjections     String[]
  competitorLandscape  String[]
  idealCustomerProfile String?
  buyingCommitteeRoles String[]
  successMetrics       String[]
  winRateByIndustry    Json?
  winRateByCompanySize Json?
  seasonalPatterns     Json?
  isActive             Boolean   @default(true)
  lastUpdated          DateTime  @updatedAt
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  seller               User      @relation("SellerProducts", fields: [sellerId], references: [id])
  workspace            Workspace @relation("WorkspaceSellerProducts", fields: [workspaceId], references: [id])

  @@unique([sellerId, productName])
  @@index([workspaceId, productCategory])
  @@index([sellerId, isActive])
}

model Account {
  id             String  @id @default(cuid())
  workspaceId    String  @db.VarChar(30)
  assignedUserId String? @db.VarChar(30)

  name        String  @db.Text
  legalName   String? @db.Text
  tradingName String? @db.Text
  localName   String? @db.Text

  website String? @db.Text
  email   String? @db.Text
  phone   String? @db.Text
  fax     String? @db.Text

  address    String? @db.Text
  city       String? @db.Text
  state      String? @db.Text
  country    String? @db.Text
  postalCode String? @db.VarChar(20)

  industry String? @db.Text
  sector   String? @db.Text
  size     String? @db.VarChar(20)
  revenue  Float?
  currency String  @default("USD") @db.VarChar(3)

  registrationNumber String? @db.Text
  taxId              String? @db.Text
  vatNumber          String? @db.Text

  description String? @db.Text
  notes       String? @db.Text

  tags         String[] @default([])
  customFields Json?    @db.JsonB

  preferredLanguage String? @db.VarChar(10)
  timezone          String? @db.VarChar(50)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace     Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  assignedUser  User?         @relation(fields: [assignedUserId], references: [id])
  contacts      Contact[]
  opportunities Opportunity[]
  accountNotes  Note[]        @relation("accountNotes")
  activities    Activity[]

  // Recruiting relations (for client companies)
  candidates Candidate[] @relation("ClientCandidates")
  jobs       Job[]       @relation("ClientJobs")

  @@unique([name, workspaceId], name: "account_name_workspace")
  @@index([workspaceId])
  @@index([assignedUserId])
  @@index([name])
  @@index([industry])
  @@index([country])
  @@index([preferredLanguage])
  @@map("accounts")
}

model EnrichmentExecution {
  id                     String               @id @default(uuid())
  executionId            String               @unique
  type                   String
  status                 String
  triggerData            Json
  currentStep            Int                  @default(0)
  totalSteps             Int                  @default(0)
  completedCompanies     Int                  @default(0)
  totalCompanies         Int                  @default(0)
  estimatedTimeRemaining Int?
  companiesEnriched      String[]
  peopleEnriched         String[]
  buyerGroupsCreated     String[]
  intelligence           Json?
  errors                 Json[]
  startTime              DateTime             @default(now())
  endTime                DateTime?
  triggerUserId          String
  workspaceId            String
  costOptimized          Boolean              @default(true)
  cacheHitRate           Float                @default(0.0)
  stepDurations          Json?
  totalDuration          Int?
  dataVolume             Json?
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  analytics              EnrichmentAnalytics?
  triggerUser            User                 @relation("EnrichmentUser", fields: [triggerUserId], references: [id])
  workspace              Workspace            @relation("WorkspaceEnrichments", fields: [workspaceId], references: [id])
  steps                  EnrichmentStep[]

  @@index([workspaceId, status])
  @@index([type, status])
  @@index([triggerUserId])
  @@index([startTime])
}

model EnrichmentStep {
  id                     String              @id @default(uuid())
  executionId            String
  stepId                 Int
  stepName               String
  status                 String
  companyId              String?
  companyName            String?
  message                String?
  progress               Float               @default(0.0)
  timeElapsed            Int                 @default(0)
  estimatedTimeRemaining Int?
  error                  String?
  errorDetails           Json?
  startedAt              DateTime?
  completedAt            DateTime?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  execution              EnrichmentExecution @relation(fields: [executionId], references: [id], onDelete: Cascade)

  @@index([executionId, stepId])
  @@index([status])
}

model EnrichmentAnalytics {
  id                    String              @id @default(uuid())
  executionId           String              @unique
  totalDuration         Int
  avgStepDuration       Float
  cacheHitRate          Float
  errorRate             Float
  companiesProcessed    Int                 @default(0)
  peopleProcessed       Int                 @default(0)
  buyerGroupsCreated    Int                 @default(0)
  intelligenceGenerated Int                 @default(0)
  apiCallsMade          Int                 @default(0)
  dataTransferred       Int                 @default(0)
  costOptimization      Float               @default(0.0)
  dataAccuracy          Float?
  validationErrors      Int                 @default(0)
  dataCompleteness      Float?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  execution             EnrichmentExecution @relation(fields: [executionId], references: [id], onDelete: Cascade)
}

model EnrichmentCache {
  id                String    @id @default(uuid())
  cacheKey          String    @unique
  cacheType         String
  cachedData        Json
  dataSize          Int       @default(0)
  quality           Float     @default(1.0)
  completeness      Float     @default(1.0)
  expiresAt         DateTime
  lastAccessedAt    DateTime  @default(now())
  accessCount       Int       @default(0)
  sourceExecutionId String?
  workspaceId       String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  workspace         Workspace @relation("WorkspaceEnrichmentCache", fields: [workspaceId], references: [id])

  @@index([cacheType, workspaceId])
  @@index([expiresAt])
  @@index([lastAccessedAt])
}

model Partnership {
  id                   String            @id @default(uuid())
  name                 String
  partnerType          String // VC, Agency, Consultant, Referral Partner, etc.
  contactName          String?
  contactTitle         String?
  contactEmail         String
  contactPhone         String?
  relationshipStatus   String            @default("Active") // Active, Inactive, Pending
  relationshipStrength String            @default("Medium") // Strong, Medium, Weak
  commissionStructure  String?
  notes                String?
  website              String?
  lastContactDate      DateTime?
  nextContactDate      DateTime?
  nextAction           String?
  workspaceId          String
  createdBy            String?
  assignedTo           String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  assignee             User?             @relation("PartnershipAssignee", fields: [assignedTo], references: [id])
  creator              User?             @relation("PartnershipCreator", fields: [createdBy], references: [id])
  workspace            Workspace         @relation("WorkspacePartnerships", fields: [workspaceId], references: [id], onDelete: Cascade)
  partnershipLeads     PartnershipLead[]

  @@unique([name, workspaceId])
  @@index([workspaceId, partnerType])
  @@index([workspaceId, relationshipStatus])
}

model PartnershipLead {
  id            String      @id @default(uuid())
  partnershipId String
  leadId        String
  referralDate  DateTime    @default(now())
  referralValue Decimal?    @db.Decimal(10, 2)
  status        String      @default("Referred") // Referred, Contacted, Qualified, Won, Lost
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  lead          Lead        @relation(fields: [leadId], references: [id], onDelete: Cascade)
  partnership   Partnership @relation(fields: [partnershipId], references: [id], onDelete: Cascade)

  @@unique([partnershipId, leadId])
  @@index([partnershipId])
  @@index([leadId])
}

model WorkspaceUser {
  id          String @id @default(cuid())
  workspaceId String @db.VarChar(30)
  userId      String @db.VarChar(30)
  role        String @default("member") @db.VarChar(20)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, userId])
  @@index([workspaceId])
  @@index([userId])
  @@index([role])
  @@map("workspace_users")
}

model Candidate {
  id        String  @id @default(uuid())
  firstName String  @db.VarChar(100)
  lastName  String  @db.VarChar(100)
  email     String  @db.VarChar(255)
  phone     String? @db.VarChar(50)
  location  Json?   @db.JsonB

  currentTitle   String   @db.VarChar(255)
  currentCompany String   @db.VarChar(255)
  experience     Int      @default(0)
  expectedSalary Decimal? @db.Decimal(10, 2)
  currentSalary  Decimal? @db.Decimal(10, 2)
  currency       String   @default("USD") @db.VarChar(3)

  skills         String[] @default([])
  certifications String[] @default([])
  education      Json[]   @default([])

  status      String   @default("sourced") @db.VarChar(50)
  stage       String?  @db.VarChar(100)
  appliedJobs String[] @default([])

  clientCompanyId   String? @db.VarChar(30)
  recruiterAssigned String  @db.VarChar(30)
  workspaceId       String  @db.VarChar(30)

  monacoIntelligence Json?   @db.JsonB
  notes              String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace     Workspace             @relation("WorkspaceCandidates", fields: [workspaceId], references: [id], onDelete: Cascade)
  recruiter     User                  @relation("CandidateRecruiter", fields: [recruiterAssigned], references: [id])
  clientCompany Account?              @relation("ClientCandidates", fields: [clientCompanyId], references: [id])
  interviews    Interview[]
  applications  JobApplication[]
  touchpoints   CandidateTouchpoint[]

  @@unique([email, workspaceId])
  @@index([workspaceId])
  @@index([recruiterAssigned])
  @@index([status])
  @@index([clientCompanyId])
  @@map("candidates")
}

model Job {
  id         String @id @default(uuid())
  title      String @db.VarChar(255)
  department String @db.VarChar(100)
  level      String @db.VarChar(50)
  type       String @default("full-time") @db.VarChar(50)
  location   Json?  @db.JsonB

  salaryMin Decimal? @db.Decimal(10, 2)
  salaryMax Decimal? @db.Decimal(10, 2)
  currency  String   @default("USD") @db.VarChar(3)
  benefits  String[] @default([])

  requirements Json?   @db.JsonB
  description  String? @db.Text

  status  String @default("open") @db.VarChar(50)
  urgency String @default("medium") @db.VarChar(20)

  clientCompanyId   String? @db.VarChar(30)
  clientCompanyName String? @db.VarChar(255)
  recruiterAssigned String  @db.VarChar(30)
  hiringManager     String? @db.VarChar(255)
  workspaceId       String  @db.VarChar(30)

  deadline  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  workspace     Workspace        @relation("WorkspaceJobs", fields: [workspaceId], references: [id], onDelete: Cascade)
  recruiter     User             @relation("JobRecruiter", fields: [recruiterAssigned], references: [id])
  clientCompany Account?         @relation("ClientJobs", fields: [clientCompanyId], references: [id])
  applications  JobApplication[]
  interviews    Interview[]

  @@index([workspaceId])
  @@index([recruiterAssigned])
  @@index([status])
  @@index([clientCompanyId])
  @@map("jobs")
}

model Interview {
  id             String   @id @default(uuid())
  candidateId    String
  jobId          String
  type           String   @db.VarChar(50)
  scheduledDate  DateTime
  interviewer    String   @db.VarChar(255)
  feedback       String?  @db.Text
  rating         Int?
  recommendation String?  @db.VarChar(50)
  status         String   @default("scheduled") @db.VarChar(50)
  duration       Int? // minutes
  notes          String?  @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job       Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([jobId])
  @@index([scheduledDate])
  @@index([status])
  @@map("interviews")
}

model JobApplication {
  id              String   @id @default(uuid())
  candidateId     String
  jobId           String
  applicationDate DateTime @default(now())
  status          String   @default("applied") @db.VarChar(50)
  source          String?  @db.VarChar(100)
  coverLetter     String?  @db.Text
  resumeUrl       String?  @db.VarChar(500)
  notes           String?  @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job       Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([candidateId, jobId])
  @@index([candidateId])
  @@index([jobId])
  @@index([status])
  @@map("job_applications")
}

model CandidateTouchpoint {
  id          String   @id @default(uuid())
  candidateId String
  type        String   @db.VarChar(50)
  date        DateTime @default(now())
  notes       String?  @db.Text
  outcome     String?  @db.VarChar(50)
  nextAction  String?  @db.VarChar(255)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([type])
  @@index([date])
  @@map("candidate_touchpoints")
}

model AgencyWorkspace {
  id            String  @id @default(uuid())
  name          String  @db.VarChar(255)
  slug          String  @unique @db.VarChar(100)
  agencyOwnerId String  @db.VarChar(30)
  settings      Json?   @db.JsonB
  isActive      Boolean @default(true)

  branding    Json? @db.JsonB
  permissions Json? @db.JsonB

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner       User            @relation("AgencyOwner", fields: [agencyOwnerId], references: [id])
  clients     ClientAccount[]
  agencyUsers AgencyUser[]

  @@index([agencyOwnerId])
  @@index([isActive])
  @@map("agency_workspaces")
}

model ClientAccount {
  id                String  @id @default(uuid())
  name              String  @db.VarChar(255)
  agencyWorkspaceId String
  workspaceId       String  @db.VarChar(30)
  permissions       Json?   @db.JsonB
  isActive          Boolean @default(true)

  contractStart  DateTime?
  contractEnd    DateTime?
  monthlyFee     Decimal?  @db.Decimal(10, 2)
  commissionRate Decimal?  @db.Decimal(5, 2)

  settings Json? @db.JsonB
  branding Json? @db.JsonB

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  agencyWorkspace AgencyWorkspace @relation(fields: [agencyWorkspaceId], references: [id], onDelete: Cascade)
  workspace       Workspace       @relation("ClientWorkspace", fields: [workspaceId], references: [id])
  clientUsers     ClientUser[]

  @@unique([agencyWorkspaceId, workspaceId])
  @@index([agencyWorkspaceId])
  @@index([isActive])
  @@map("client_accounts")
}

model AgencyUser {
  id                String  @id @default(uuid())
  userId            String  @db.VarChar(30)
  agencyWorkspaceId String
  role              String  @default("recruiter") @db.VarChar(50)
  permissions       Json?   @db.JsonB
  isActive          Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user            User            @relation("AgencyUser", fields: [userId], references: [id])
  agencyWorkspace AgencyWorkspace @relation(fields: [agencyWorkspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, agencyWorkspaceId])
  @@index([agencyWorkspaceId])
  @@index([role])
  @@map("agency_users")
}

model ClientUser {
  id              String  @id @default(uuid())
  userId          String  @db.VarChar(30)
  clientAccountId String
  role            String  @default("hiring_manager") @db.VarChar(50)
  permissions     Json?   @db.JsonB
  isActive        Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user          User          @relation("ClientUser", fields: [userId], references: [id])
  clientAccount ClientAccount @relation(fields: [clientAccountId], references: [id], onDelete: Cascade)

  @@unique([userId, clientAccountId])
  @@index([clientAccountId])
  @@index([role])
  @@map("client_users")
}

model Note {
  id          String @id @default(cuid())
  workspaceId String @db.VarChar(30)
  authorId    String @db.VarChar(30)

  leadId        String? @db.VarChar(30)
  opportunityId String? @db.VarChar(30)
  accountId     String? @db.VarChar(30)
  contactId     String? @db.VarChar(30)

  title   String? @db.Text
  content String  @db.Text
  summary String? @db.Text

  type      String  @default("general") @db.VarChar(20)
  priority  String  @default("normal") @db.VarChar(10)
  isPrivate Boolean @default(false)
  isPinned  Boolean @default(false)

  format      String @default("text") @db.VarChar(20)
  attachments Json?  @db.JsonB

  tags String[] @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace   Workspace    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  author      User         @relation("userNotes", fields: [authorId], references: [id])
  lead        Lead?        @relation("leadNotes", fields: [leadId], references: [id])
  opportunity Opportunity? @relation("opportunityNotes", fields: [opportunityId], references: [id])
  account     Account?     @relation("accountNotes", fields: [accountId], references: [id])
  contact     Contact?     @relation("contactNotes", fields: [contactId], references: [id])

  @@index([workspaceId])
  @@index([authorId])
  @@index([leadId])
  @@index([opportunityId])
  @@index([accountId])
  @@index([contactId])
  @@index([type])
  @@map("notes")
}

model Activity {
  id          String @id @default(cuid())
  workspaceId String @db.VarChar(30)
  userId      String @db.VarChar(30)

  leadId        String? @db.VarChar(30)
  opportunityId String? @db.VarChar(30)
  accountId     String? @db.VarChar(30)
  contactId     String? @db.VarChar(30)

  type        String  @db.VarChar(30)
  subject     String  @db.Text
  description String? @db.Text
  outcome     String? @db.Text

  scheduledAt DateTime?
  completedAt DateTime?
  duration    Int?

  status   String @default("planned") @db.VarChar(20)
  priority String @default("normal") @db.VarChar(10)

  attachments Json? @db.JsonB
  metadata    Json? @db.JsonB

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace   Workspace    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  user        User         @relation(fields: [userId], references: [id])
  lead        Lead?        @relation(fields: [leadId], references: [id])
  opportunity Opportunity? @relation(fields: [opportunityId], references: [id])
  account     Account?     @relation(fields: [accountId], references: [id])
  contact     Contact?     @relation(fields: [contactId], references: [id])

  @@index([workspaceId])
  @@index([userId])
  @@index([leadId])
  @@index([opportunityId])
  @@index([accountId])
  @@index([contactId])
  @@index([type])
  @@index([status])
  @@index([scheduledAt])
  @@map("activities")
}

model NightlifeEvent {
  id              String   @id @default(uuid())
  platform        String   @db.VarChar(50) // 'posh', 'partiful', 'tablelistpro'
  eventId         String   @db.VarChar(255)
  eventName       String   @db.Text
  eventDate       DateTime
  venueLocation   String?  @db.Text
  
  // Event metrics
  ticketsSold     Int?     @default(0)
  revenue         Float?   @default(0)
  currency        String   @default("USD") @db.VarChar(3)
  guestCount      Int?     @default(0)
  
  // Event details
  eventType       String?  @db.VarChar(100) // 'party', 'networking', 'concert', etc.
  ageRange        String?  @db.VarChar(50)  // '21-30', '25-35', etc.
  dresscode       String?  @db.VarChar(100)
  
  // Customer/Guest data (anonymized for privacy)
  customerData    Json?    @db.JsonB
  attendeeData    Json?    @db.JsonB
  
  // Integration data
  rawData         Json?    @db.JsonB // Raw webhook/API data
  syncedAt        DateTime @default(now())
  
  // Relations
  workspaceId     String?  @db.VarChar(30)
  workspace       Workspace? @relation("WorkspaceNightlifeEvents", fields: [workspaceId], references: [id])
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([platform, eventId])
  @@index([platform])
  @@index([eventDate])
  @@index([venueLocation])
  @@index([workspaceId])
  @@map("nightlife_events")
}

// Channel Partner Management Models
model ChannelPartnerProgram {
  id                    String                   @id @default(uuid())
  name                  String
  description           String?
  programType           String                   // Reseller, Distributor, VAR, OEM, Affiliate, etc.
  tier                  String                   // Platinum, Gold, Silver, Bronze
  status                String                   @default("Active") // Active, Inactive, Pending, Suspended
  commissionStructure   Json                     // Flexible commission rules
  minimumCommitment     Decimal?                 @db.Decimal(15, 2)
  maximumDiscount       Float?                   // Maximum discount partners can offer
  territories           String[]                 // Geographic territories
  verticals             String[]                 // Industry verticals
  productCategories     String[]                 // Product categories they can sell
  requiresCertification Boolean                  @default(false)
  certificationUrl      String?
  contractTermMonths    Int?
  autoRenewal           Boolean                  @default(true)
  workspaceId           String
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  workspace             Workspace                @relation("WorkspaceChannelPrograms", fields: [workspaceId], references: [id])
  partners              ChannelPartner[]
  products              ChannelPartnerProduct[]
  
  @@index([workspaceId, status])
  @@index([programType])
}

model ChannelPartner {
  id                    String                   @id @default(uuid())
  companyName           String
  legalName             String?
  contactName           String
  contactTitle          String?
  contactEmail          String
  contactPhone          String?
  website               String?
  address               String?
  city                  String?
  state                 String?
  country               String
  postalCode            String?
  
  // Program Details
  programId             String
  partnerType           String                   // Pure Play, Bundler, Strategic, Technology
  tier                  String
  status                String                   @default("Active")
  joinDate              DateTime                 @default(now())
  contractEndDate       DateTime?
  lastReviewDate        DateTime?
  nextReviewDate        DateTime?
  
  // Business Details
  companySize           String?                  // 1-10, 11-50, 51-200, etc.
  industry              String?
  annualRevenue         Decimal?                 @db.Decimal(15, 2)
  employeeCount         Int?
  targetMarkets         String[]
  technicalCapability   String                   // Basic, Intermediate, Advanced, Expert
  marketingMaturity     String                   // Basic, Intermediate, Advanced, Expert
  
  // Performance Metrics
  totalSales            Decimal                  @default(0) @db.Decimal(15, 2)
  qtdSales              Decimal                  @default(0) @db.Decimal(15, 2)
  ytdSales              Decimal                  @default(0) @db.Decimal(15, 2)
  dealsWon              Int                      @default(0)
  averageDealSize       Decimal?                 @db.Decimal(10, 2)
  salesCycleLength      Int?                     // Days
  customerSatisfaction  Float?                   // 1-5 rating
  certificationStatus   String                   @default("Not Required") // Required, In Progress, Certified, Expired
  
  // Relationship Management
  accountManagerId      String?
  partnershipStrength   String                   @default("Medium") // Strong, Medium, Weak
  communicationFreq     String                   @default("Monthly") // Weekly, Bi-weekly, Monthly, Quarterly
  lastContactDate       DateTime?
  nextContactDate       DateTime?
  notes                 String?
  
  workspaceId           String
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  program               ChannelPartnerProgram    @relation(fields: [programId], references: [id])
  accountManager        User?                    @relation("PartnerAccountManager", fields: [accountManagerId], references: [id])
  workspace             Workspace                @relation("WorkspaceChannelPartners", fields: [workspaceId], references: [id])
  sales                 ChannelSale[]
  products              ChannelPartnerProduct[]
  bundles               ProductBundle[]
  enablementActivities  PartnerEnablement[]
  
  @@unique([contactEmail, workspaceId])
  @@index([workspaceId, status])
  @@index([programId, tier])
  @@index([partnerType])
}

model ChannelPartnerProduct {
  id                    String                   @id @default(uuid())
  partnerId             String
  programId             String
  productName           String
  productCategory       String
  productType           String                   // Own Product, Partner Product, Bundle Component
  
  // Product Details
  description           String?
  sku                   String?
  manufacturerId        String?                  // If selling another company's product
  manufacturerName      String?
  listPrice             Decimal                  @db.Decimal(10, 2)
  partnerPrice          Decimal                  @db.Decimal(10, 2)
  minimumPrice          Decimal?                 @db.Decimal(10, 2)
  commissionRate        Float                    // Percentage
  
  // Sales Information
  isActive              Boolean                  @default(true)
  requiresTraining      Boolean                  @default(false)
  salesMaterials        String[]                 // URLs to sales materials
  technicalSpecs        Json?
  targetCustomerProfile String?
  competitorAnalysis    Json?
  pricingStrategy       Json?
  
  // Performance
  unitsSold             Int                      @default(0)
  totalRevenue          Decimal                  @default(0) @db.Decimal(15, 2)
  averageSalePrice      Decimal?                 @db.Decimal(10, 2)
  winRate               Float?
  
  workspaceId           String
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  partner               ChannelPartner           @relation(fields: [partnerId], references: [id])
  program               ChannelPartnerProgram    @relation(fields: [programId], references: [id])
  workspace             Workspace                @relation("WorkspaceChannelProducts", fields: [workspaceId], references: [id])
  bundleComponents      ProductBundleComponent[]
  sales                 ChannelSale[]
  
  @@unique([partnerId, sku])
  @@index([workspaceId, isActive])
  @@index([productCategory, isActive])
  @@index([manufacturerId])
}

model ProductBundle {
  id                    String                   @id @default(uuid())
  name                  String
  description           String?
  bundleType            String                   // Standard, Custom, Dynamic
  partnerId             String
  
  // Pricing
  totalListPrice        Decimal                  @db.Decimal(10, 2)
  bundlePrice           Decimal                  @db.Decimal(10, 2)
  discountPercentage    Float                    // Overall bundle discount
  commissionRate        Float                    // Bundle commission rate
  
  // Business Rules
  isActive              Boolean                  @default(true)
  minimumQuantity       Int                      @default(1)
  maximumQuantity       Int?
  validFrom             DateTime                 @default(now())
  validUntil            DateTime?
  targetMarkets         String[]
  targetCustomerTypes   String[]
  
  // Performance
  bundlesSold           Int                      @default(0)
  totalRevenue          Decimal                  @default(0) @db.Decimal(15, 2)
  averageSalePrice      Decimal?                 @db.Decimal(10, 2)
  customerSatisfaction  Float?
  
  workspaceId           String
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  partner               ChannelPartner           @relation(fields: [partnerId], references: [id])
  workspace             Workspace                @relation("WorkspaceProductBundles", fields: [workspaceId], references: [id])
  components            ProductBundleComponent[]
  sales                 ChannelSale[]
  
  @@index([workspaceId, isActive])
  @@index([partnerId, isActive])
  @@index([bundleType])
}

model ProductBundleComponent {
  id                    String                   @id @default(uuid())
  bundleId              String
  productId             String
  quantity              Int                      @default(1)
  unitPrice             Decimal                  @db.Decimal(10, 2)
  discountPercentage    Float?
  isRequired            Boolean                  @default(true)
  isConfigurable        Boolean                  @default(false)
  sortOrder             Int                      @default(0)
  
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  bundle                ProductBundle            @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  product               ChannelPartnerProduct    @relation(fields: [productId], references: [id])
  
  @@unique([bundleId, productId])
  @@index([bundleId, sortOrder])
}

model ChannelSale {
  id                    String                   @id @default(uuid())
  partnerId             String
  productId             String?
  bundleId              String?
  saleType              String                   // Product, Bundle, Service
  
  // Customer Information
  customerName          String
  customerEmail         String?
  customerIndustry      String?
  customerSize          String?
  
  // Sale Details
  quantity              Int                      @default(1)
  unitPrice             Decimal                  @db.Decimal(10, 2)
  totalAmount           Decimal                  @db.Decimal(15, 2)
  discountAmount        Decimal?                 @db.Decimal(10, 2)
  finalAmount           Decimal                  @db.Decimal(15, 2)
  commissionAmount      Decimal                  @db.Decimal(10, 2)
  commissionRate        Float
  
  // Tracking
  saleDate              DateTime                 @default(now())
  quarter               String                   // Q1-2024, Q2-2024, etc.
  fiscalYear            String                   // FY2024, FY2025, etc.
  territory             String?
  vertical              String?
  
  // Status
  status                String                   @default("Closed Won") // Lead, Opportunity, Proposal, Closed Won, Closed Lost
  stage                 String?
  probability           Float?
  expectedCloseDate     DateTime?
  actualCloseDate       DateTime?
  
  // Commission Processing
  commissionStatus      String                   @default("Pending") // Pending, Approved, Paid, Disputed
  commissionPaidDate    DateTime?
  
  workspaceId           String
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  partner               ChannelPartner           @relation(fields: [partnerId], references: [id])
  product               ChannelPartnerProduct?   @relation(fields: [productId], references: [id])
  bundle                ProductBundle?           @relation(fields: [bundleId], references: [id])
  workspace             Workspace                @relation("WorkspaceChannelSales", fields: [workspaceId], references: [id])
  
  @@index([workspaceId, saleDate])
  @@index([partnerId, quarter])
  @@index([status, commissionStatus])
  @@index([saleDate])
}

model PartnerEnablement {
  id                    String                   @id @default(uuid())
  partnerId             String
  activityType          String                   // Training, Certification, Webinar, Conference, Marketing Support
  title                 String
  description           String?
  
  // Schedule
  scheduledDate         DateTime?
  completedDate         DateTime?
  duration              Int?                     // Minutes
  location              String?                  // Physical or Virtual
  
  // Content
  materials             String[]                 // URLs to materials
  prerequisites         String[]
  learningObjectives    String[]
  assessmentRequired    Boolean                  @default(false)
  certificationAwarded  String?
  
  // Participation
  status                String                   @default("Scheduled") // Scheduled, In Progress, Completed, Cancelled, No Show
  attendeeCount         Int?
  satisfactionScore     Float?                   // 1-5 rating
  feedback              String?
  
  // Tracking
  providerId            String?                  // User who delivered the training
  cost                  Decimal?                 @db.Decimal(10, 2)
  internalNotes         String?
  
  workspaceId           String
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  
  partner               ChannelPartner           @relation(fields: [partnerId], references: [id])
  provider              User?                    @relation("EnablementProvider", fields: [providerId], references: [id])
  workspace             Workspace                @relation("WorkspacePartnerEnablement", fields: [workspaceId], references: [id])
  
  @@index([workspaceId, activityType])
  @@index([partnerId, status])
  @@index([scheduledDate])
}

// Federated Intelligence & Industry Consortiums
model IndustryConsortium {
  id                   String   @id @default(cuid())
  name                 String
  industry             String
  description          String
  founderId            String
  privacyPolicy        String
  dataRetention        Int      @default(365)
  anonymizationLevel   String   @default("differential_privacy")
  minimumAggregation   Int      @default(5)
  allowedDataTypes     String[]
  governanceRules      String[]
  status               String   @default("active")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  members              ConsortiumMember[]
  insights             ConsortiumInsight[]
  activities           ConsortiumActivity[]
  membershipRequests   ConsortiumMembershipRequest[]

  @@map("industry_consortiums")
}

model ConsortiumMember {
  id                  String   @id @default(cuid())
  organizationId      String
  consortiumId        String
  joinDate            DateTime @default(now())
  status              String   @default("active")
  permissions         String[]
  dataContributions   Int      @default(0)
  dataConsumption     Int      @default(0)
  privacyScore        Float    @default(100)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  consortium          IndustryConsortium @relation(fields: [consortiumId], references: [id], onDelete: Cascade)

  @@unique([organizationId, consortiumId])
  @@map("consortium_members")
}

model ConsortiumInsight {
  id              String   @id @default(cuid())
  consortiumId    String
  contributorId   String
  insightType     String
  title           String
  description     String
  data            Json
  sensitivity     String
  privacyMetadata Json
  status          String   @default("active")
  sharedAt        DateTime @default(now())
  revokedAt       DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  consortium      IndustryConsortium @relation(fields: [consortiumId], references: [id], onDelete: Cascade)

  @@map("consortium_insights")
}

model ConsortiumActivity {
  id             String   @id @default(cuid())
  consortiumId   String
  organizationId String
  activityType   String
  description    String
  metadata       Json?
  timestamp      DateTime @default(now())

  consortium     IndustryConsortium @relation(fields: [consortiumId], references: [id], onDelete: Cascade)

  @@map("consortium_activities")
}

model ConsortiumMembershipRequest {
  id                     String   @id @default(cuid())
  organizationId         String
  consortiumId           String
  businessJustification  String
  dataTypesToShare       String[]
  intendedUseCase        String
  status                 String   @default("pending_approval")
  requestDate            DateTime @default(now())
  reviewedAt             DateTime?
  reviewerId             String?
  reviewNotes            String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  consortium             IndustryConsortium @relation(fields: [consortiumId], references: [id], onDelete: Cascade)

  @@map("consortium_membership_requests")
}

model ConsentLog {
  id             String   @id @default(cuid())
  organizationId String
  consortiumId   String
  action         String   // 'grant', 'revoke', 'modify'
  dataType       String
  reason         String?
  timestamp      DateTime @default(now())

  @@map("consent_logs")
}

//  VAULT - Enterprise Document Storage & Management
model VaultDocument {
  id              String            @id @default(uuid())
  title           String
  description     String?
  content         Json?
  fileUrl         String?
  fileType        String
  fileSize        Int?
  classification  String            @default("internal") // public, internal, confidential, restricted
  category        String
  version         String            @default("1.0")
  status          String            @default("draft") // draft, review, approved, published, archived
  tags            String[]
  ownerId         String
  workspaceId     String?
  companyId       String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  lastAccessedAt  DateTime?
  viewCount       Int               @default(0)
  downloadCount   Int               @default(0)
  
  // Due diligence tracking
  dueDiligenceSection String?
  priority            String?         @default("medium") // high, medium, low
  required            Boolean         @default(false)
  completionStatus    String          @default("pending") // complete, pending, missing
  
  // Relations
  owner               User            @relation(fields: [ownerId], references: [id])
  workspace           Workspace?      @relation(fields: [workspaceId], references: [id])
  company             Company?        @relation(fields: [companyId], references: [id])
  shares              DocumentShare[]
  signatures          DocumentSignature[]
  dataRoomDocs        DataRoomDocument[]
  dueDiligenceItems   DueDiligenceItem[]
  
  @@index([ownerId])
  @@index([workspaceId])
  @@index([classification])
  @@index([category])
  @@index([dueDiligenceSection])
}

//  PAPER SIGN - Document Signing System
model DocumentSignature {
  id              String        @id @default(uuid())
  documentId      String?       // For vault documents
  paperId         String?       // For paper documents
  signerEmail     String
  signerName      String
  signerCompany   String?
  signerTitle     String?
  signatureType   String        @default("electronic") // electronic, digital, wet
  signatureData   Json?         // Signature image/data
  signedAt        DateTime?
  status          String        @default("pending") // pending, signed, expired, declined
  ipAddress       String?
  userAgent       String?
  location        String?
  
  // NDA workflow
  isNDA           Boolean       @default(false)
  ndaType         String?       // standard, mutual, unilateral
  accessGranted   Boolean       @default(false)
  documentsUnlocked String[]    // List of document IDs unlocked after signing
  
  // Tracking
  createdAt       DateTime      @default(now())
  expiresAt       DateTime?
  reminderSentAt  DateTime?
  viewedAt        DateTime?
  
  // Relations
  document        VaultDocument? @relation(fields: [documentId], references: [id])
  paper           Paper?        @relation(fields: [paperId], references: [id])
  
  @@index([signerEmail])
  @@index([status])
  @@index([isNDA])
  @@index([createdAt])
}

//  Data Rooms for Investor/Partner Access
model DataRoom {
  id              String          @id @default(uuid())
  name            String
  description     String?
  purpose         String          // fundraising, acquisition, partnership, compliance
  status          String          @default("active") // active, archived, pending
  accessLevel     String          @default("view") // view, download, full
  
  // Security settings
  requiresNDA     Boolean         @default(true)
  watermarked     Boolean         @default(true)
  downloadEnabled Boolean         @default(false)
  printEnabled    Boolean         @default(false)
  expiresAt       DateTime?
  
  // Analytics
  viewCount       Int             @default(0)
  downloadCount   Int             @default(0)
  lastAccessedAt  DateTime?
  
  // Relations
  ownerId         String
  workspaceId     String?
  companyId       String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  owner           User            @relation(fields: [ownerId], references: [id])
  workspace       Workspace?      @relation(fields: [workspaceId], references: [id])
  company         Company?        @relation(fields: [companyId], references: [id])
  documents       DataRoomDocument[]
  invites         DataRoomInvite[]
  
  @@index([ownerId])
  @@index([purpose])
  @@index([status])
}

model DataRoomDocument {
  id           String        @id @default(uuid())
  dataRoomId   String
  documentId   String
  order        Int           @default(0)
  addedAt      DateTime      @default(now())
  
  dataRoom     DataRoom      @relation(fields: [dataRoomId], references: [id], onDelete: Cascade)
  document     VaultDocument @relation(fields: [documentId], references: [id])
  
  @@unique([dataRoomId, documentId])
}

model DataRoomInvite {
  id              String      @id @default(uuid())
  dataRoomId      String
  email           String
  name            String?
  company         String?
  title           String?
  accessLevel     String      @default("view") // view, download, full
  status          String      @default("pending") // pending, accepted, expired
  
  // Access tracking
  invitedAt       DateTime    @default(now())
  expiresAt       DateTime?
  acceptedAt      DateTime?
  lastAccessedAt  DateTime?
  viewCount       Int         @default(0)
  downloadCount   Int         @default(0)
  
  dataRoom        DataRoom    @relation(fields: [dataRoomId], references: [id], onDelete: Cascade)
  
  @@index([email])
  @@index([status])
}

//  Due Diligence Framework
model DueDiligenceChecklist {
  id              String              @id @default(uuid())
  name            String
  description     String?
  framework       String              @default("sitka") // sitka, custom
  purpose         String              // fundraising, acquisition, ipo
  completionRate  Float               @default(0)
  
  workspaceId     String?
  companyId       String?
  ownerId         String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  workspace       Workspace?          @relation(fields: [workspaceId], references: [id])
  company         Company?            @relation(fields: [companyId], references: [id])
  owner           User                @relation(fields: [ownerId], references: [id])
  sections        DueDiligenceSection[]
  
  @@index([ownerId])
  @@index([framework])
  @@index([purpose])
}

model DueDiligenceSection {
  id              String                    @id @default(uuid())
  checklistId     String
  title           String
  description     String?
  category        String                    // corporate, financial, legal, operational, technical, compliance
  priority        String                    @default("medium") // high, medium, low
  order           Int                       @default(0)
  completionRate  Float                     @default(0)
  daysToComplete  Int?
  
  checklist       DueDiligenceChecklist     @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  items           DueDiligenceItem[]
  
  @@index([checklistId])
  @@index([category])
  @@index([priority])
}

model DueDiligenceItem {
  id              String               @id @default(uuid())
  sectionId       String
  title           String
  description     String?
  required        Boolean              @default(true)
  status          String               @default("pending") // complete, pending, missing, not_applicable
  documentId      String?
  notes           String?
  completedAt     DateTime?
  assignedTo      String?
  
  section         DueDiligenceSection  @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  document        VaultDocument?       @relation(fields: [documentId], references: [id])
  assignee        User?                @relation(fields: [assignedTo], references: [id])
  
  @@index([sectionId])
  @@index([status])
  @@index([required])
}
